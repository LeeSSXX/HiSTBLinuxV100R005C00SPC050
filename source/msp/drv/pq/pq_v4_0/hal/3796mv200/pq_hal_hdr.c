/******************************************************************************
*
* Copyright (C) 2016 Hisilicon Technologies Co., Ltd.  All rights reserved.
*
* This program is confidential and proprietary to Hisilicon  Technologies Co., Ltd. (Hisilicon),
*  and may not be copied, reproduced, modified, disclosed to others, published or used, in
* whole or in part, without the express prior written permission of Hisilicon.
*
*****************************************************************************

  File Name    : pq_hal_hdr.c
  Version       : Initial Draft
  Author        : sdk
                      sdk
  Created      : 2016/06/15
  Description  :

******************************************************************************/
#include <linux/string.h>

#include "hi_type.h"
#include "hi_math.h"

#include "pq_hal_comm.h"
#include "drv_pq_ext.h"
#include "pq_hal_hdr.h"

#define HDR_MIN(x, y) (((x) > (y)) ? (y) : (x))

static const HI_S32 g_au32SinTable[61] =
{
    -500, -485, -469, -454, -438, -422, -407, -391,
    -374, -358, -342, -325, -309, -292, -276, -259,
    -242, -225, -208, -191, -174, -156, -139, -122,
    -104,  -87,  -70,  -52,  -35,  -17,    0,   17,
    35,     52,   70,   87,  104,  122,  139,  156,
    174,   191,  208,  225,  242,  259,  276,  292,
    309,   325,  342,  358,  374,  391,  407,  422,
    438,   454,  469,  485,  500
};

static const HI_U32 g_au32CosTable[61] =
{
    866, 875, 883, 891, 899,  906,  914,  921,
    927, 934, 940, 946, 951,  956,  961,  966,
    970, 974, 978, 982, 985,  988,  990,  993,
    995, 996, 998, 999, 999, 1000, 1000, 1000,
    999, 999, 998, 996, 995,  993,  990,  988,
    985, 982, 978, 974, 970,  966,  961,  956,
    951, 946, 940, 934, 927,  921,  914,  906,
    899, 891, 883, 875, 866
};


HI_S32 HiPP_HDR_HDR10toSDRTMApi(HI_PQ_HDR_CFG *pstPqHdrCfg, DM_INFO_S *pstDminfo);
HI_S32 HiPP_HDR_CalcXPos(HI_U32 *pTM_xlut , HI_PQ_HDR_CFG *pstPqHdrCfg);

static HI_PQ_HDR_CFG *pg_stPqHdrCfg     = HI_NULL;
static PQ_PARAM_S *sg_pstHalHdrPqParam  = HI_NULL;
static HI_PQ_HDR_MODE_E sg_enHDRMode    = HI_PQ_HDR_MODE_HDR10_TO_SDR;

static DM_INFO_S stDminfo = {0};

static HI_U32 sg_u32HdrTmMode = 0;//选择HDR参数模式。0:固定参数，1:软算法参数，2.工具调试参数
static HI_U32 sg_u32HdrSmMode = 0;//选择HDR参数模式。0:固定参数，1:软算法参数，2.工具调试参数

static HI_U32 sg_u32TMScaleCoef = 7;
static HI_U32 sg_u32SMScaleCoef = 7;

static HI_U32 sg_u32SrcAvgLum = 150000;
static HI_U32 sg_u32TargMinLum = 1000;
static HI_U32 sg_u32TargAvgLum = 2000000;
static HI_U32 sg_u32TargMaxLum = 3000000;
static HI_U32 sg_u32Contrast = 320;
static HI_U32 sg_u32HdrLwAvg = 300;
static HI_U32 sg_u32UhdMaxLumDefault = 15000000;
static HI_U32 sg_u32FhdMaxLumDefault = 15000000;

static HI_U32 sg_u32SrcMinPQ = 0;
static HI_U32 sg_u32SrcMaxPQ = 0;

HI_S16 g_aDstCSCTable[3][3];
HI_S16 g_as16DcOutR2Y[3] = { 64,  512,  512 };

HI_S16 g_aDstHdrOffsetCSCTable[3][3];
HI_S16 g_as16HdrOffsetDcOutR2Y[3] = { 64,  512,  512 };


static HI_U32 g_u32TMLutXStep[8] =        /* U5.0  [0,20] */
{
    5, 7, 9, 10, 11, 13, 15, 17
};

static HI_U32 g_u32TMLutXPos[8]  =        /* U20.0 [0,1048575] */
{
    128, 1024, 2048, 6144, 16384, 131072, 655360, 2097151
};

static HI_U32 g_u32TMLutXNum[8]  =        /* U6.0  [0,63] */
{
    4, 11, 13, 17, 22, 36, 52, 63
};

static HI_U32 g_u32TMLutXNumP[8]  =        /* U6.0  [0,63] */
{
    4,  7, 2, 4, 5, 14, 16, 11
};

static HI_U32 g_u32TMLut_debug[64] =       /* U9.7 [0,65535] */
{
    23914,    23914,    22658,    21587,    20660,    17904,    16054,    14705,
    13667,    12838,    12157,    11585,    9977 ,    8965 ,    7732 ,    6987 ,
    6476 ,    6099 ,    5567 ,    5199 ,    4922 ,    4701 ,    4518 ,    3990 ,
    3628 ,    3345 ,    3110 ,    2908 ,    2731 ,    2573 ,    2430 ,    2301 ,
    2184 ,    2076 ,    1977 ,    1885 ,    1801 ,    1520 ,    1307 ,    1142 ,
    1010 ,    903  ,    815  ,    743  ,    681  ,    630  ,    585  ,    546  ,
    512  ,    482  ,    455  ,    431  ,    410  ,    341  ,    293  ,    256  ,
    228  ,    205  ,    186  ,    171  ,    158  ,    146  ,    137  ,    128
};

static HI_U32 g_u32SMLutXStep[PQ_SMAP_SEG_SIZE] =        /* U5.0  [0,21] */
{
    5,  7,  9,  10,  11, 13, 15, 17
};

static HI_U32 g_u32SMLutXPos[PQ_SMAP_SEG_SIZE]  =        /* U21.0 [0,1048575] */
{
    128, 1024,    2048,   6144,   16384,   131072,  655360, 2097151
};

static HI_U32 g_u32SMLutXNum[PQ_SMAP_SEG_SIZE]  =        /* U6.0  [0,63] */
{
    4,  11, 13, 17, 22, 36, 52, 63
};

static HI_U32 g_u32SMLutXNumP[PQ_SMAP_SEG_SIZE]  =        /* U6.0  [0,63] */
{
    4,  11, 13, 17, 22, 36, 52, 63
};

static HI_U32 g_u32SMLut_debug[64] =                  //U2.8 [0,1023]
{
    256,    256,    256,    256,    256,    256,    256,    256,
    256,    256,    256,    256,    256,    256,    256,    256,
    256,    256,    256,    256,    256,    256,    256,    256,
    256,    256,    256,    256,    256,    256,    256,    256,
    256,    256,    256,    256,    256,    256,    256,    256,
    256,    256,    256,    256,    256,    256,    256,    256,
    256,    256,    256,    256,    256,    256,    256,    256,
    256,    256,    256,    256,    256,    256,    256,    256
};

/* YUV to RGB params: 10bit in, 10bit out */
static const HI_U16 u16ScaleY2R     = 11;    /*U4.0  [0,15] */
static const HI_U16 u16ClipMinY2R   = 0;     /* U10.0  [0,1023] */
static const HI_U16 u16ClipMaxY2R   = 4095;  /* U10.0  [0,1023] */

static const HI_S16 as16DcInY2R_L[3] =       /* S10.0  [-1024, 1023] */
{
    -64,
    -512,
    -512
};

static const HI_S16 as16DcInY2R_F[3] =
{
    0,
    0,
    0
};

static const HI_S16 as16M33Y2R_601L[3][3] =
{
    {9567 , 0      ,  13113} ,
    {9567 , -3219 ,  -6679},
    {9567 , 16557 ,  0    }
};

static const HI_S16 as16M33Y2R_601F[3][3] =
{
    {8192 ,  0      ,   11485} ,
    {8192 ,  -2819  ,  -5850 },
    {8192 , 14501  ,    0   }
};

static const HI_S16 as16M33Y2R_709L[3][3] =
{
    {9567,           0,       14729},
    {9567,       -1752,       -4379},
    {9567,       17356,           0}
};

static const HI_S16 as16M33Y2R_709F[3][3] =
{
    {8192,           0 ,      12901},
    {8192,       -1535 ,      -3835},
    {8192 ,       15201 ,          0}
};

static const HI_S16 as16M33Y2R_2020L[3][3] =
{
    {9567,           0 ,      13792},
    {9567,       -1539 ,      -5344},
    {9567 ,       17597,           0}
};

static const HI_S16 as16M33Y2R_2020F[3][3] =
{
    {8192,           0 ,      12080},
    {8192 ,      -1348  ,     -4681},
    {8192 ,      15412 ,          0}
};

static const HI_S16 as16DcOutY2R[3] =      /*  S10.0 [-1024, 1023] */
{
    0,
    0,
    0
};

/* ToneMapping Tmap Params: 20bit in, 20bit out */
static const HI_U16 u16ScaleLumaCal       = 15;                   /* U4.0  [0,15] */
static const HI_U16 au16M3LumaCal_2020[3] = {8608, 22217, 1943};  /* U1.15 [0, 65535]     {0.2627, 0.6780, 0.0593}<<u16ScaleLumaCal */
static const HI_U16 au16M3LumaCal_709[3]  = {6970, 23432, 2366};  /* U1.15 [0, 65535]      */
static const HI_U16 au16M3LumaCal_601[3]  = {9798, 19235, 3736};  // U1.15 [0, 65535]

static const HI_U16 u16ScaleCoefTM       = 7;                    /*  U4.0  [0,15] */
static const HI_U32 u32ClipMinTM         = 0;                    /*  U21.0  [0,2097152] */
static const HI_U32 u32ClipMaxTM         = 2097151;              /*  U21.0  [0,2097152] */

/* ToneMapping Smap Params: 20bit in, 20bit out */
static const HI_U16 u16SmapScaleLumaCal      = 15;                   /* U4.0  [0,15] */
static const HI_U16 au16SmapM3LumaCal[3]     = {8608, 22217, 1943};  /* U1.15 [0, 65535]     {0.2627, 0.6780, 0.0593}<<u16ScaleLumaCal */
static const HI_U16 u16SmapScaleCoef         = 8;                    /*  U4.0  [0,15] */
static const HI_U32 u32SmapClipMinTM         = 0;                    /*  U21.0  [0,2097152] */
static const HI_U32 u32SmapClipMaxTM         = 2097151;              /*  U21.0  [0,2097152] */
static const HI_S32 as32SmapTMOff[3]         = {0, 0, 0};            /*  S20.0  [-524288,524287] */
static const HI_S32 as32SmapTMOff_HLG2SDR[3] = {350, 350, 350};      /*  S20.0  [-524288,524287] */

/* GamutMapping Params: 20bit in, 20bit out  */
static const HI_U32 u32ClipMinGMap  = 0;            /*   U20.0 [0,1048575] */
static const HI_U32 u32ClipMaxGMap  = 2097151;      //U21.0 [0,2097151]
static const HI_U16 u16ScaleGMap    = 14;           /*  U4.0  [0,15] */
static const HI_S16 as16M33GMap_2020to709[3][3] =   /*  S1.14 [-2^15, 2^15-1] = [-32768, 32767] */
{
    /* 2020 to 709 */
    {27209 ,      -9632  ,     -1194 },
    { -2045 ,      18565  ,      -138 },
    { -297  ,     -1648   ,    18330     }
};

static const HI_S16 as16M33GMap_709to2020[3][3] =               /*   S1.14 [-2^15, 2^15-1] = [-32768, 32767]  */
{
    /* 709 to 2020  */
    {10279 ,       5396  ,       710},
    {1134  ,     15064   ,      187 },
    {268   ,     1442    ,   14673  }
};

static const HI_S16 as16M33GMap_linear[3][3] =                  /*  S1.14 [-2^15, 2^15-1] = [-32768, 32767] */
{
    /* Linear */
    { 16384,       0  ,       0 },
    {     0,     16384,       0 },
    {     0,       0  ,   16384 }
};

static const HI_S16 as16M33GMAP_Pal_601_709[3][3] =
{
    //BT601 to BT709
    {17106  ,      -724      ,    -1 },
    { -2   ,    16386    ,       0 },
    { 1    ,    193     ,  16191  }
};

static const HI_S16 as16M33GMAP_Ntsc_601_709[3][3] =
{
    //BT601 to BT709
    { 15394  ,       820     ,    167 },
    {  290   ,    15826    ,     269},
    {  -26   ,      -72   ,    16483  }
};

static const HI_S16 as16M33GMAP_Pal_601_2020[3][3] =
{
    //BT601 to BT2020
    { 10731 ,       4951   ,      701 },
    { 1182  ,     15018   ,      184 },
    {  280   ,     1603   ,   14500  }
};

static const HI_S16 as16M33GMAP_Ntsc_601_2020[3][3] =
{
    //BT601 to BT2020
    {  9752    ,    5723   ,      908 },
    { 1331    ,   14606    ,     447 },
    {  254    ,    1342    ,   14788  }
};


/* RGB to YUV Params */
/* --------------R2Y:RGB2YUV-------------------------------- */

static const HI_U16 u16ScaleR2Y         = 14;   /* U4.0  [0,15] */
static const HI_U16 u16ClipMinRF2YL_Y   = 64;   /* U10.0  [0,1023] */
static const HI_U16 u16ClipMaxRF2YL_Y   = 940;  /* U10.0  [0,1023] */
static const HI_U16 u16ClipMinRF2YL_UV  = 64;   /* U10.0  [0,1023] */
static const HI_U16 u16ClipMaxRF2YL_UV  = 960;  /* U10.0  [0,1023] */

static const HI_U16 u16ClipMinRF2YF_Y   = 0;    // U10.0  [0,1023]
static const HI_U16 u16ClipMaxRF2YF_Y   = 1023; // U10.0  [0,1023]
static const HI_U16 u16ClipMinRF2YF_UV  = 0;    // U10.0  [0,1023]
static const HI_U16 u16ClipMaxRF2YF_UV  = 1023; // U10.0  [0,1023]

static const HI_S16 as16DcInRF2YL[3] =                            /* S10.0  [-1024, 1023] */
{
    0,
    0,
    0
};

static const  HI_S16 as16DcInRF2YF[3] =      // S10.0  [-1024, 1023]
{
    0,
    0,
    0
};

static const HI_S16 as16M33RF2YL_709[3][3] =      // S1.14 [-32768, 32767]
{
    //BT709
    {2984  ,     10034   ,     1013  },
    { -1643 ,      -5531  ,      7175 },
    {7175  ,     -6518   ,     -659  }
};

static const HI_S16 as16M33RF2YL_2020NCL[3][3] =      // S1.14 [-32768, 32767]
{
    //BT2020
    {3685  ,      9512  ,       832  },
    { -2004 ,      -5171 ,       7175 },
    {7175  ,     -6598  ,      -577  }
};

static const HI_S16 as16M33RF2YL_601[3][3] =      // S1.14 [-32768, 32767]
{
    //BT601
    {4195    ,    8235   ,     1599  },
    { -2421 ,      -4754  ,      7175 },
    {7175   ,    -6004    ,   -1167  }
};

static const HI_S16  as16M33RF2YF_709[3][3] =      // S1.14 [-32768, 32767]
{
    //BT709
    {3483    ,   11718     ,   1183  },
    { -1877  ,     -6315   ,     8192 },
    { 8192   ,    -7441    ,    -751  }
};

static const HI_S16  as16M33RF2YF_2020NCL[3][3] =      // S1.14 [-32768, 32767]
{
    //BT2020
    { 4304   ,    11108    ,     972  },
    { -2288   ,    -5904   ,     8192 },
    {8192     ,  -7533     ,   -659  }
};

static const HI_S16 as16M33RF2YF_601[3][3] =      // S1.14 [-32768, 32767]
{
    //BT601
    {4899    ,    9617     ,   1868 },
    { -2765   ,    -5427    ,    8192 },
    { 8192   ,    -6855    ,   -1332 }
};

static const HI_S16 as16DcOutRF2YL[3]  =       /* s10.0  [-1024,1023] */
{
    64,
    512,
    512
};

static const HI_S16 as16DcOutRF2YF[3] =
{
    0,
    512,
    512
};  // s10.0  [-1024,1023]

/* ------------------R2Y:RGB2RGB---------------------------- */
static const HI_U16  u16ScaleRF2RF      = 14;   // U4.0  [0,15]
static const HI_U16  u16ClipMinRF2RF_Y  = 0;    // U10.0  [0,1023]
static const HI_U16  u16ClipMaxRF2RF_Y  = 1023; // U10.0  [0,1023]
static const HI_U16  u16ClipMinRF2RF_UV = 0;    // U10.0  [0,1023]
static const HI_U16  u16ClipMaxRF2RF_UV = 1023; // U10.0  [0,1023]

static const HI_S16  as16DcInRF2RF[3] =      // S10.0  [-1024, 1023]
{
    0,
    0,
    0
};

static const HI_S16  as16M33RF2RF[3][3] =      // S1.14 [-32768, 32767]
{
    {16384    ,   0     ,   0  },
    { 0  ,     16384   ,     0 },
    { 0   ,    0    ,    16384  }
};

static const HI_S16  as16DcOutRF2RF[3] =
{
    0,
    0,
    0
};  // s10.0  [-1024,1023]

/* ---------------------------------------------- */

/************* DeGamma Params **************/
static const HI_U32 au32DeGmm_step[PQ_DEGMM_SEG_SIZE] =
{
    1, 2, 3, 4, 5, 6, 7, 8
};          /*U4.0  [0,15] */

static const HI_U32 au32DeGmm_pos[PQ_DEGMM_SEG_SIZE]  =
{
    4, 16, 32, 128, 256, 2560, 3584, 4095
};/*U10.0 [0,1023] */

static const HI_U32 au32DeGmm_num[PQ_DEGMM_SEG_SIZE]  =
{
    2, 5, 7, 13, 17, 53, 61, 63
};        /*U6.0  [0,63] */

// DePQ curve: MPEG HDR
static const HI_U32 au32DeGmmLut_PQ[64] =                           //U21.0 [0,2097151]
{
    0 ,         0 ,         0 ,         0 ,         0 ,         0 ,         0 ,         0 ,
    1 ,         1 ,         2 ,         2 ,         3 ,         5 ,         7 ,        11 ,
    15 ,        21 ,        36 ,        58 ,        86 ,       125 ,       174 ,       237 ,
    316 ,       415 ,       536 ,       684 ,       865 ,      1082 ,      1343 ,      1654 ,
    2025 ,      2465 ,      2984 ,      3596 ,      4315 ,      5157 ,      6143 ,      7294 ,
    8634 ,     10194 ,     12007 ,     14110 ,     16547 ,     19369 ,     22633 ,     26406 ,
    30763 ,     35793 ,     41596 ,     48288 ,     56002 ,     64892 ,     86935 ,    116188 ,
    155014 ,    206576 ,    275129 ,    366417 ,    488226 ,    651170 ,   1164118 ,   2097151 ,
};

// DeHLG Curve: BBC HDR
static const HI_U32 au32DeGmmLut_HLG[64] =                              //U21.0 [0,2097151]
{
    0 ,         0 ,         1 ,         3 ,         6 ,        11 ,        24 ,        43 ,
    96 ,       171 ,       267 ,       384 ,       523 ,       683 ,      1067 ,      1537 ,
    2092 ,      2732 ,      4269 ,      6147 ,      8367 ,     10928 ,     13831 ,     17075 ,
    20661 ,     24588 ,     28857 ,     33467 ,     38419 ,     43712 ,     49347 ,     55323 ,
    61641 ,     68300 ,     75301 ,     82643 ,     90327 ,     98352 ,    106719 ,    115427 ,
    124477 ,    133868 ,    143601 ,    153675 ,    164091 ,    174848 ,    186273 ,    198741 ,
    212348 ,    227197 ,    243403 ,    261088 ,    280389 ,    301452 ,    349526 ,    406781 ,
    474971 ,    556185 ,    652910 ,    768109 ,    905311 ,   1068716 ,   1495116 ,   2097151 ,
};

static const HI_U32 au32DeGmmLut_SLF[64] =                               //U21.0 [0,2097151]
{
    0 ,         0 ,         0 ,         0 ,         0 ,         0 ,         0 ,         0 ,
    0 ,         0 ,         0 ,         1 ,         1 ,         1 ,         1 ,         1 ,
    2 ,         3 ,         5 ,         8 ,        13 ,        21 ,        32 ,        48 ,
    70 ,       101 ,       143 ,       199 ,       273 ,       369 ,       493 ,       651 ,
    851 ,      1102 ,      1414 ,      1800 ,      2273 ,      2849 ,      3547 ,      4387 ,
    5394 ,      6595 ,      8021 ,      9706 ,     11690 ,     14017 ,     16736 ,     19905 ,
    23586 ,     27850 ,     32778 ,     38460 ,     44999 ,     52511 ,     70999 ,     95219 ,
    126885 ,    168308 ,    222692 ,    294624 ,    390928 ,    522269 ,    974953 ,   2097151 ,
};

// DeGamma Curve: SDR
static const HI_U32 au32DeGmmLut_24[64] =                            //U21.0 [0,2097151]
{
    0 ,         0 ,         0 ,         1 ,         2 ,         3 ,         9 ,        18 ,
    49 ,        97 ,       166 ,       257 ,       372 ,       512 ,       875 ,      1356 ,
    1963 ,      2704 ,      4619 ,      7155 ,     10358 ,     14271 ,     18934 ,     24381 ,
    30647 ,     37765 ,     45763 ,     54671 ,     64517 ,     75325 ,     87122 ,     99932 ,
    113779 ,    128684 ,    144670 ,    161758 ,    179970 ,    199324 ,    219841 ,    241540 ,
    264439 ,    288557 ,    313912 ,    340521 ,    368401 ,    397569 ,    428041 ,    459835 ,
    492964 ,    527446 ,    563296 ,    600527 ,    639157 ,    679198 ,    763573 ,    853766 ,
    949885 ,   1052038 ,   1160327 ,   1274854 ,   1395717 ,   1523013 ,   1797278 ,   2097151 ,
};

static const HI_U32 au32DeGmmLut_22[64] =                            //U21.0 [0,2097151]
{
    0 ,         0 ,         1 ,         2 ,         6 ,        11 ,        26 ,        49 ,
    118 ,       223 ,       364 ,       544 ,       764 ,      1025 ,      1674 ,      2500 ,
    3509 ,      4708 ,      7691 ,     11487 ,     16124 ,     21630 ,     28029 ,     35340 ,
    43584 ,     52780 ,     62942 ,     74088 ,     86232 ,     99387 ,    113568 ,    128785 ,
    145052 ,    162380 ,    180780 ,    200261 ,    220835 ,    242511 ,    265299 ,    289207 ,
    314244 ,    340420 ,    367742 ,    396218 ,    425856 ,    456664 ,    488650 ,    521820 ,
    556182 ,    591742 ,    628508 ,    666486 ,    705682 ,    746103 ,    830645 ,    920159 ,
    1014692 ,   1114289 ,   1218993 ,   1328845 ,   1443887 ,   1564158 ,   1820538 ,   2097151 ,
};

static const HI_U32 au32DeGmmLut_BT709[64] =                             //U21.0 [0,2097151]
{
    0 ,       228 ,       455 ,       910 ,      1366 ,      1821 ,      2731 ,      3642 ,
    5463 ,      7284 ,      9104 ,     10925 ,     12746 ,     14567 ,     18209 ,     21851 ,
    25492 ,     29134 ,     36418 ,     43827 ,     52116 ,     61201 ,     71096 ,     81811 ,
    93360 ,    105752 ,    118998 ,    133110 ,    148095 ,    163964 ,    180726 ,    198389 ,
    216963 ,    236454 ,    256871 ,    278223 ,    300515 ,    323756 ,    347952 ,    373111 ,
    399239 ,    426344 ,    454430 ,    483505 ,    513574 ,    544645 ,    576722 ,    609811 ,
    643919 ,    679050 ,    715210 ,    752404 ,    790639 ,    829918 ,    911631 ,    997583 ,
    1087813 ,   1182358 ,   1281254 ,   1384536 ,   1492238 ,   1604393 ,   1842194 ,   2097151 ,
};

/* ---------------------------------------------- */

/*************** ToneMapping Lut Params:  *******************************/
static const HI_U32 au32TMapStep[PQ_TMAP_SEG_SIZE] =        /* U5.0  [0,20] */
{
    5, 7, 9, 10, 11, 13, 15, 17
};

static const HI_U32 au32TMapPos[PQ_TMAP_SEG_SIZE]  =        /* U20.0 [0,1048575] */
{
    128, 1024, 2048, 6144, 16384, 131072, 655360, 2097151
};

static const HI_U32 au32TMapNum[PQ_TMAP_SEG_SIZE]  =        /* U6.0  [0,63] */
{
    4, 11, 13, 17, 22, 36, 52, 63
};

/*sdr2hdr10*/

static const HI_U32 au32TMLut_x_step_sdr2hdr10[PQ_TMAP_SEG_SIZE] =        /* U5.0  [0,20] */
{
    5,  7,  9,  10,  11, 13, 15, 17
};

static const HI_U32 au32TMLut_x_pos_sdr2hdr10[PQ_TMAP_SEG_SIZE]  =        /* U20.0 [0,1048575] */
{
    64 * 2, 512 * 2,    1024 * 2,   3072 * 2,   8192 * 2,   65536 * 2,  327680 * 2, 1048575 * 2
};

static const HI_U32 au32TMLut_x_num_sdr2hdr10[PQ_TMAP_SEG_SIZE]  =        /* U6.0  [0,63] */
{
    4,  11, 13, 17, 22, 36, 52, 63
};

static const HI_U32 au32SMLut_x_step_sdr2hdr10[PQ_TMAP_SEG_SIZE] =        //U5.0  [0,21]
{
    5,  7,  9,  10,  11, 13, 15, 17
};

static const HI_U32 au32SMLut_x_pos_sdr2hdr10[PQ_TMAP_SEG_SIZE]  =        //U21.0 [0,2097151]
{
    64 * 2, 512 * 2,    1024 * 2,   3072 * 2,   8192 * 2,   65536 * 2,  327680 * 2, 1048575 * 2
};

static const HI_U32 au32SMLut_x_num_sdr2hdr10[PQ_TMAP_SEG_SIZE]  =        //U6.0  [0,63]
{
    4,  11, 13, 17, 22, 36, 52, 63
};

/* ToneMapping Lut: HDR10  to SDR */
static const HI_U16 u16ScaleCoefTM_HDR10toSDR   = 8;         /* U4.0  [0,15] */
static const HI_U32 au32TMLut_HDR10toSDR[64]    =
{
    5000,
    5000,
    7000,
    9000,
    10568,
    10091,
    9768 ,
    9531 ,
    9348 ,
    9200 ,
    9078 ,
    8974 ,
    8675 ,
    8478 ,
    8220 ,
    8045 ,
    7912 ,
    7801 ,
    7619 ,
    7467 ,
    7332 ,
    7209 ,
    7093 ,
    6680 ,
    6317 ,
    5988 ,
    5686 ,
    5407 ,
    5149 ,
    4909 ,
    4685 ,
    4477 ,
    4282 ,
    4099 ,
    3929 ,
    3769 ,
    3619 ,
    3104 ,
    2698 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560 ,
    2560
};

// ToneMapping Lut: SLF to SDR
static const HI_U16 u16ScaleCoefTM_SLF2SDR = 7;        // U4.0  [0,15]
static const HI_U32 au32TMLut_SLF2SDR[64] =
{
    //U9.7 [0,65535]
    2748     ,
    2748     ,
    2741     ,
    2801     ,
    2781     ,
    2803     ,
    2807     ,
    2798     ,
    2802     ,
    2803     ,
    2797     ,
    2797     ,
    2792     ,
    2787     ,
    2772     ,
    2760     ,
    2747     ,
    2733     ,
    2707     ,
    2681     ,
    2656     ,
    2631     ,
    2606     ,
    2509     ,
    2417     ,
    2330     ,
    2247     ,
    2168     ,
    2093     ,
    2021     ,
    1953     ,
    1888     ,
    1827     ,
    1768     ,
    1711     ,
    1658     ,
    1607     ,
    1424     ,
    1271     ,
    1142     ,
    1033     ,
    940      ,
    861      ,
    792      ,
    733      ,
    681      ,
    635      ,
    595      ,
    559      ,
    527      ,
    498      ,
    472      ,
    449      ,
    375      ,
    321      ,
    281      ,
    250      ,
    225      ,
    204      ,
    187      ,
    173      ,
    160      ,
    150      ,
    140      ,
};

/* ToneMapping Lut: SDR to HDR10 */
static const HI_U16 u16ScaleCoefTM_SDR2HDR = 15;         /* U4.0  [0,15] */
static const HI_U32 au32TMLut_SDR2HDR[64] =                   //U1.15 [0,65535]
{
    10820,
    10820,
    5410 ,
    3743 ,
    4522 ,
    6551 ,
    6799 ,
    6947 ,
    6926 ,
    6905 ,
    6889 ,
    6853 ,
    6774 ,
    6714 ,
    6604 ,
    6510 ,
    6474 ,
    6434 ,
    6354 ,
    6285 ,
    6236 ,
    6201 ,
    6175 ,
    6092 ,
    6070 ,
    6040 ,
    6019 ,
    6024 ,
    6030 ,
    6038 ,
    6047 ,
    6056 ,
    6064 ,
    6093 ,
    6105 ,
    6131 ,
    6159 ,
    6248 ,
    6370 ,
    6475 ,
    6600 ,
    6745 ,
    6877 ,
    7033 ,
    7176 ,
    7338 ,
    7508 ,
    7668 ,
    7855 ,
    8037 ,
    8212 ,
    8418 ,
    8610 ,
    9475 ,
    10474,
    11620,
    12945,
    14521,
    16321,
    18500,
    21081,
    24253,
    28346,
    32733
};

/*************** ToneMapping Smap Lut Params:  *******************************/
static const HI_U32 au32SMapStep[PQ_SMAP_SEG_SIZE] =        /* U5.0  [0,21] */
{
    5,  7,  9,  10,  11, 13, 15, 17
};

static const HI_U32 au32SMapPos[PQ_SMAP_SEG_SIZE]  =        /* U21.0 [0,1048575] */
{
    128, 1024,    2048,   6144,   16384,   131072,  655360, 2097151
};

static const HI_U32 au32SMapNum[PQ_SMAP_SEG_SIZE]  =        /* U6.0  [0,63] */
{
    4,  11, 13, 17, 22, 36, 52, 63
};

/* ToneMapping Smap Lut: SLF  to HDR10 */
static const HI_U32 au32SMLutLinear[64] =                  //U2.8 [0,1023]
{
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256
};

/* ToneMapping Smap Lut: SLF  to SDR */
static const HI_U32 au32SMLut_SLF2SDR[64] =                    //U2.8 [0,1023]
{
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    240,
    234,
    230,
    226,
    222,
    218,
    214,
    205,
    199,
    194,
    191,
    188,
    185,
    183,
    181,
    179,
    177,
    175,
    173,
    172,
    170,
    165,
    159,
    155,
    151,
    147,
    143,
    140,
    137,
    134,
    131,
    128,
    126,
};

/* ToneMapping Smap Lut: SDR  to HDR */
static const HI_U32 au32SMLut_SDR2HDR[64] =
{
    //U2.8 [0,1023]
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
    333      ,
};


/* ToneMapping Smap Lut: HDR10  to SDR */
static const HI_U16 u16ScaleCoefSM = 8;         /* U4.0  [0,15] */
static const HI_U32 au32SMLut_HDR10toSDR[64] =            //U2.8 [0,1023]
{
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    248,
    240,
    234,
    230,
    226,
    222,
    218,
    214,
    205,
    199,
    194,
    191,
    188,
    185,
    183,
    181,
    179,
    177,
    175,
    173,
    172,
    170,
    165,
    159,
    155,
    151,
    147,
    143,
    140,
    137,
    134,
    131,
    128,
    126,
};

/* ToneMapping Lut: HDR10 to BBC */
static const HI_U16 u16ScaleCoefTM_HDR10toHLG = 10;        /* U4.0  [0,15] */
static const HI_U32 u32TMLut_HDR10toHLG[64] =              /*U6.10 [0,65535] */
{
    46552,
    46552,
    40832,
    37818,
    35815,
    31414,
    29095,
    27554,
    26416,
    25520,
    24787,
    24169,
    22385,
    21199,
    19634,
    18594,
    17826,
    17222,
    16310,
    15636,
    15106,
    14672,
    14306,
    13250,
    12548,
    12029,
    11622,
    11288,
    11006,
    10764,
    10551,
    10363,
    10194,
    10041,
    9901 ,
    9772 ,
    9654 ,
    9255 ,
    8941 ,
    8684 ,
    8192 ,
    7282 ,
    6554 ,
    5958 ,
    5461 ,
    5041 ,
    4681 ,
    4369 ,
    4096 ,
    3855 ,
    3641 ,
    3449 ,
    3277 ,
    2731 ,
    2341 ,
    2048 ,
    1820 ,
    1638 ,
    1489 ,
    1365 ,
    1260 ,
    1170 ,
    1092 ,
    1024
};

static const HI_U16 u16ScaleCoefTM_HLGtoHDR10 = 15;  // U4.0  [0,15]
static const HI_U32 au32TMLut_HLGtoHDR10[64] =     //U1.15 [0,65535]
{
    2853 ,
    2853 ,
    3277 ,
    3554 ,
    3764 ,
    4324 ,
    4689 ,
    4967 ,
    5193 ,
    5386 ,
    5555 ,
    5705 ,
    6187 ,
    6554 ,
    7107 ,
    7528 ,
    7872 ,
    8164 ,
    8648 ,
    9042 ,
    9378 ,
    9672 ,
    9933 ,
    10773,
    11411,
    11931,
    12374,
    12762,
    13107,
    13420,
    13705,
    13969,
    14214,
    14444,
    14659,
    14863,
    15056,
    15743,
    16328,
    16839,
    17295,
    17707,
    18084,
    18432,
    18756,
    19059,
    19343,
    19612,
    19867,
    20109,
    20340,
    20562,
    20774,
    21545,
    22220,
    22821,
    23365,
    23863,
    24322,
    24749,
    25148,
    25524,
    25878,
    26214
};

/* ToneMapping Smap Lut: BBC to HDR10 */
static const HI_U16 u16ScaleCoefSM_HLGtoHDR10 = 8;           /* U4.0  [0,15] */
static const HI_U32 au32SMLut_HLGtoHDR10[64] =                /*U1.15 [0,65535] */
{
    /*PQ1250*/
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256
};

/* ToneMapping Lut: HLG to SDR */
static const HI_U16 u16ScaleCoefTM_HLGtoSDR = 12;          /* U4.0  [0,15] */
static const HI_U32 au32TMLut_HLGtoSDR[64] =
{
    13079 ,     13079 ,      7301 ,      5383 ,      4443 ,      3110 ,      2728 ,      2570 ,
    2497 ,      2464 ,      2451 ,      2450 ,      2494 ,      2562 ,      2697 ,      2816 ,
    2920 ,      3012 ,      3170 ,      3301 ,      3414 ,      3514 ,      3604 ,      3891 ,
    4108 ,      4283 ,      4431 ,      4558 ,      4670 ,      4769 ,      4858 ,      4939 ,
    5013 ,      5080 ,      5142 ,      5200 ,      5253 ,      5433 ,      5571 ,      5679 ,
    5764 ,      5829 ,      5880 ,      5919 ,      5946 ,      5965 ,      5975 ,      5979 ,
    5977 ,      5969 ,      5957 ,      5941 ,      5921 ,      5813 ,      5670 ,      5507 ,
    5332 ,      5150 ,      4966 ,      4784 ,      4604 ,      4429 ,      4259 ,      4096 ,
};

/* ToneMapping Smap Lut: HLG to SDR */
static const HI_U16 u16ScaleCoefSM_HLGtoSDR = 8;//12;          /* U4.0  [0,15] */
static const HI_U32 au32SMLut_HLGtoSDR[64] =
{
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    218,
    208,
    205,
    201,
    199,
    185,
    165,
    125,
    95 ,
    60 ,
    40 ,
    40 ,
    40 ,
    40 ,
    40 ,
    40 ,
    40 ,
    40 ,
    30 ,
    30 ,
    30 ,
    30 ,
    30 ,
    20 ,
    20 ,
    20 ,
    20 ,
    20 ,
    20 ,
    10 ,
    10
};

/* ToneMapping Lut: AVS to HDR10 */
static const HI_U16 u16ScaleCoefTM_Linear = 8;             /* U4.0  [0,15] */
static const HI_U32 au32TMLut_Linear[64] =                 /* U8.8 [0,65535] */
{
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256,
    256
};

/******************* Gmm-8 Lut Params *************************/
static const HI_U32 au32GmmLut_x_step[8] =        //U5.0  [0,21]
{
    3,  5,  7,  9,  11, 12, 15, 17
};

static const HI_U32 au32GmmLut_x_pos[8]  =        //U21.0 [0,2097151]
{
    32, 128,    1024,   2048,   8192,   65536,  655360, 2097151
};

static const HI_U32 au32GmmLut_x_num[8]  =        //U6.0  [0,63]
{
    4,  7,  14, 16, 19, 33, 51, 62
};


// PQ Curve

static const HI_U32 au32GmmLut_PQ10000[64] =              //U12.0 [0,4095]
{
    0 ,       167 ,       227 ,       270 ,       304 ,       400 ,       466 ,       517 ,
    657 ,       750 ,       820 ,       878 ,       927 ,       970 ,      1008 ,      1129 ,
    1220 ,      1454 ,      1600 ,      1708 ,      1866 ,      1980 ,      2071 ,      2147 ,
    2211 ,      2267 ,      2317 ,      2362 ,      2403 ,      2440 ,      2475 ,      2507 ,
    2537 ,      2565 ,      2743 ,      2870 ,      2969 ,      3051 ,      3120 ,      3179 ,
    3232 ,      3279 ,      3321 ,      3360 ,      3396 ,      3429 ,      3460 ,      3489 ,
    3516 ,      3541 ,      3565 ,      3588 ,      3668 ,      3736 ,      3795 ,      3847 ,
    3893 ,      3934 ,      3972 ,      4007 ,      4039 ,      4068 ,      4095 ,      4095 ,

} ;

static const HI_U32 au32GmmLut_PQ4000[64] =              //U12.0 [0,4095]
{
    0 ,       108 ,       151 ,       182 ,       206 ,       278 ,       328 ,       367 ,
    477 ,       552 ,       609 ,       657 ,       698 ,       733 ,       765 ,       868 ,
    945 ,      1149 ,      1279 ,      1376 ,      1519 ,      1624 ,      1708 ,      1778 ,
    1838 ,      1891 ,      1938 ,      1980 ,      2019 ,      2055 ,      2087 ,      2118 ,
    2147 ,      2173 ,      2345 ,      2468 ,      2565 ,      2645 ,      2712 ,      2771 ,
    2823 ,      2870 ,      2912 ,      2951 ,      2987 ,      3020 ,      3051 ,      3079 ,
    3107 ,      3132 ,      3156 ,      3179 ,      3261 ,      3330 ,      3389 ,      3442 ,
    3489 ,      3531 ,      3570 ,      3605 ,      3638 ,      3668 ,      3697 ,      3697 ,
} ;

static const HI_U32 au32GmmLut_PQ2000[64] =              //U12.0 [0,4095]
{
    0 ,        77 ,       108 ,       132 ,       151 ,       206 ,       246 ,       278 ,
    367 ,       429 ,       477 ,       517 ,       552 ,       582 ,       609 ,       698 ,
    765 ,       945 ,      1062 ,      1149 ,      1279 ,      1376 ,      1454 ,      1519 ,
    1575 ,      1624 ,      1668 ,      1708 ,      1745 ,      1778 ,      1809 ,      1838 ,
    1866 ,      1891 ,      2055 ,      2173 ,      2267 ,      2345 ,      2411 ,      2468 ,
    2519 ,      2565 ,      2607 ,      2645 ,      2680 ,      2712 ,      2743 ,      2771 ,
    2798 ,      2823 ,      2847 ,      2870 ,      2951 ,      3020 ,      3079 ,      3132 ,
    3179 ,      3222 ,      3261 ,      3296 ,      3330 ,      3360 ,      3389 ,      3389 ,
} ;

static const HI_U32 au32GmmLut_PQ1250[64] =              //U12.0 [0,4095]
{
    0       , 0      , 60     , 86     , 105    , 157    , 193    , 221    ,
    300     , 355    , 398    , 433    , 464    , 491    , 516    , 595    ,
    656     , 820    , 927    , 1008   , 1129   , 1220   , 1293   , 1354   ,
    1407    , 1454   , 1496   , 1534   , 1568   , 1600   , 1630   , 1658   ,
    1684    , 1708   , 1866   , 1980   , 2071   , 2147   , 2211   , 2267   ,
    2317    , 2362   , 2403   , 2440   , 2475   , 2507   , 2537   , 2565   ,
    2591    , 2616   , 2640   , 2663   , 2743   , 2811   , 2870   , 2922   ,
    2969    , 3012   , 3051   , 3086   , 3120   , 3150   , 3179   , 3179
} ;

static const HI_U32 au32GmmLut_PQ1200[64] =              //U12.0 [0,4095]
{
    0 ,        59 ,        84 ,       103 ,       118 ,       164 ,       197 ,       223 ,
    299 ,       352 ,       394 ,       429 ,       459 ,       486 ,       510 ,       588 ,
    648 ,       810 ,       916 ,       997 ,      1117 ,      1207 ,      1279 ,      1340 ,
    1393 ,      1440 ,      1481 ,      1519 ,      1554 ,      1585 ,      1615 ,      1643 ,
    1668 ,      1693 ,      1849 ,      1964 ,      2055 ,      2130 ,      2194 ,      2250 ,
    2300 ,      2345 ,      2385 ,      2423 ,      2457 ,      2489 ,      2519 ,      2547 ,
    2574 ,      2599 ,      2622 ,      2645 ,      2725 ,      2793 ,      2852 ,      2904 ,
    2951 ,      2994 ,      3032 ,      3068 ,      3101 ,      3132 ,      3161 ,      3161 ,
} ;

static const HI_U32 au32GmmLut_PQ1000[64] =              //U12.0 [0,4095]
{
    0 ,        54 ,        77 ,        94 ,       108 ,       151 ,       182 ,       206 ,
    278 ,       328 ,       367 ,       400 ,       429 ,       454 ,       477 ,       552 ,
    609 ,       765 ,       868 ,       945 ,      1062 ,      1149 ,      1220 ,      1279 ,
    1331 ,      1376 ,      1417 ,      1454 ,      1488 ,      1519 ,      1548 ,      1575 ,
    1600 ,      1624 ,      1778 ,      1891 ,      1980 ,      2055 ,      2118 ,      2173 ,
    2223 ,      2267 ,      2308 ,      2345 ,      2379 ,      2411 ,      2440 ,      2468 ,
    2494 ,      2519 ,      2543 ,      2565 ,      2645 ,      2712 ,      2771 ,      2823 ,
    2870 ,      2912 ,      2951 ,      2987 ,      3020 ,      3051 ,      3079 ,      3079 ,
} ;

//HLG Curve
static const HI_U32 au32GmmLut_HLG[64] =              //U12.0 [0,4095]
{
    0 ,        14 ,        20 ,        24 ,        28 ,        39 ,        48 ,        55 ,
    78 ,        96 ,       111 ,       124 ,       136 ,       147 ,       157 ,       192 ,
    222 ,       314 ,       384 ,       443 ,       543 ,       627 ,       701 ,       768 ,
    830 ,       887 ,       941 ,       991 ,      1040 ,      1086 ,      1130 ,      1173 ,
    1214 ,      1254 ,      1536 ,      1774 ,      1983 ,      2166 ,      2314 ,      2436 ,
    2541 ,      2633 ,      2715 ,      2788 ,      2855 ,      2916 ,      2973 ,      3025 ,
    3074 ,      3120 ,      3163 ,      3204 ,      3347 ,      3467 ,      3570 ,      3661 ,
    3741 ,      3813 ,      3879 ,      3940 ,      3996 ,      4048 ,      4095 ,      4095 ,
};

// Gamma Curve
static const HI_U32 au32GmmLut_22[64] =              //U12.0 [0,4095]
{
    0 ,        14 ,        19 ,        23 ,        26 ,        36 ,        44 ,        50 ,
    68 ,        82 ,        93 ,       103 ,       112 ,       120 ,       128 ,       154 ,
    175 ,       240 ,       289 ,       329 ,       396 ,       451 ,       500 ,       543 ,
    582 ,       619 ,       653 ,       685 ,       715 ,       744 ,       771 ,       798 ,
    823 ,       848 ,      1019 ,      1162 ,      1286 ,      1397 ,      1498 ,      1592 ,
    1679 ,      1762 ,      1840 ,      1914 ,      1985 ,      2053 ,      2118 ,      2181 ,
    2242 ,      2301 ,      2358 ,      2414 ,      2623 ,      2813 ,      2989 ,      3153 ,
    3308 ,      3455 ,      3594 ,      3727 ,      3855 ,      3978 ,      4095 ,      4095 ,

};

static const HI_U32 au32GmmLut_24[64] =              //U12.0 [0,4095]
{
    0 ,        14 ,        19 ,        23 ,        26 ,        36 ,        44 ,        50 ,
    68 ,        82 ,        93 ,       103 ,       112 ,       120 ,       128 ,       154 ,
    175 ,       240 ,       289 ,       329 ,       396 ,       451 ,       500 ,       543 ,
    582 ,       619 ,       653 ,       685 ,       715 ,       744 ,       771 ,       798 ,
    823 ,       848 ,      1019 ,      1162 ,      1286 ,      1397 ,      1498 ,      1592 ,
    1679 ,      1762 ,      1840 ,      1914 ,      1985 ,      2053 ,      2118 ,      2181 ,
    2242 ,      2301 ,      2358 ,      2414 ,      2623 ,      2813 ,      2989 ,      3153 ,
    3308 ,      3455 ,      3594 ,      3727 ,      3855 ,      3978 ,      4095 ,      4095 ,

};

static const HI_U32 au32GmmLut_bt709[64] =              //U12.0 [0,4095]
{
    0 ,         0 ,         0 ,         0 ,         0 ,         1 ,         1 ,         1 ,
    2 ,         3 ,         5 ,         6 ,         7 ,         8 ,         9 ,        14 ,
    18 ,        36 ,        54 ,        72 ,       108 ,       144 ,       180 ,       216 ,
    252 ,       288 ,       324 ,       360 ,       394 ,       426 ,       456 ,       486 ,
    514 ,       541 ,       730 ,       887 ,      1024 ,      1146 ,      1257 ,      1360 ,
    1457 ,      1547 ,      1632 ,      1714 ,      1792 ,      1866 ,      1938 ,      2007 ,
    2074 ,      2138 ,      2201 ,      2262 ,      2490 ,      2698 ,      2890 ,      3069 ,
    3238 ,      3398 ,      3549 ,      3694 ,      3833 ,      3967 ,      4095 ,      4095 ,
};
static HI_U32 g_u32Bright   = 128;
static HI_U32 g_u32Contrast = 128;
static HI_U32 g_u32Satu     = 128;
static HI_U32 g_u32Hue      = 128;

static HI_U32 g_u32Red      = 128;
static HI_U32 g_u32Green    = 128;
static HI_U32 g_u32Blue     = 128;

HI_S32 PQ_HAL_SetHdrCscSetting(HI_PQ_PICTURE_SETTING_S *pstPicSetting)
{
    PQ_CHECK_NULL_PTR(pstPicSetting);

    g_u32Bright   = (HI_U32)pstPicSetting->u16Brightness;
    g_u32Contrast = (HI_U32)pstPicSetting->u16Contrast;
    g_u32Satu     = (HI_U32)pstPicSetting->u16Hue;
    g_u32Hue      = (HI_U32)pstPicSetting->u16Saturation;

    return HI_SUCCESS;
}
static HI_VOID PQ_hal_CalCSCCoefRGBtoYCbCr(HI_U32 Contrast, HI_U32 Saturation, HI_U32 Hue,
        HI_U32 Kr, HI_U32 Kg, HI_U32 Kb,
        HI_S16 pCSCTable[3][3], HI_S16 pDstCSCTable[3][3])
{
    HI_S32 ContrastAdjust;
    HI_S32 SaturationAdjust;
    HI_S32 rGain, gGain, bGain;

    ContrastAdjust   = Contrast   * 40 / 51;
    SaturationAdjust = Saturation * 40 / 51;
    Hue   = Hue * 60 / 255;
    rGain = Kr  * 40 / 51;
    gGain = Kg  * 40 / 51;
    bGain = Kb  * 40 / 51;

    g_aDstCSCTable[0][0] = (HI_S16)((HI_S32)pCSCTable[0][0] * ContrastAdjust * rGain  / 10000);
    g_aDstCSCTable[0][1] = (HI_S16)((HI_S32)pCSCTable[0][1] * ContrastAdjust * gGain  / 10000);
    g_aDstCSCTable[0][2] = (HI_S16)((HI_S32)pCSCTable[0][2] * ContrastAdjust * bGain  / 10000);
    g_aDstCSCTable[1][0]  = (HI_S16)(((HI_S32)(pCSCTable[1][0] * g_au32CosTable[Hue]) / 1000
                                      + (HI_S32)(pCSCTable[2][0] * g_au32SinTable[Hue]) / 1000)
                                     * SaturationAdjust * rGain / 10000);
    g_aDstCSCTable[1][1]  = (HI_S16)(((HI_S32)(pCSCTable[1][1] * g_au32CosTable[Hue]) / 1000
                                      + (HI_S32)(pCSCTable[2][1] * g_au32SinTable[Hue]) / 1000)
                                     * SaturationAdjust * gGain  / 10000);
    g_aDstCSCTable[1][2]  = (HI_S16)(((HI_S32)(pCSCTable[1][2] * g_au32CosTable[Hue]) / 1000
                                      + (HI_S32)(pCSCTable[2][2] * g_au32SinTable[Hue]) / 1000)
                                     * SaturationAdjust * bGain  / 10000);
    g_aDstCSCTable[2][0] = (HI_S16)(((HI_S32)(pCSCTable[2][0] * g_au32CosTable[Hue]) / 1000
                                     - (HI_S32)(pCSCTable[1][0] * g_au32SinTable[Hue]) / 1000)
                                    * SaturationAdjust * rGain  / 10000);
    g_aDstCSCTable[2][1] = (HI_S16)(((HI_S32)(pCSCTable[2][1] * g_au32CosTable[Hue]) / 1000
                                     - (HI_S32)(pCSCTable[1][1] * g_au32SinTable[Hue]) / 1000)
                                    * SaturationAdjust * gGain  / 10000);
    g_aDstCSCTable[2][2] = (HI_S16)(((HI_S32)(pCSCTable[2][2] * g_au32CosTable[Hue]) / 1000
                                     - (HI_S32)(pCSCTable[1][2] * g_au32SinTable[Hue]) / 1000)
                                    * SaturationAdjust * bGain  / 10000);
    return;
}

static HI_S32 pq_hal_SetY2RMatrix(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->stY2R.u16ScaleY2R = u16ScaleY2R;

    switch (enInCS)
    {
        case HI_DRV_CS_BT2020_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16M33Y2R_2020L,   sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16DcInY2R_L,      sizeof(HI_S16) * 3);
            break;
        case HI_DRV_CS_BT2020_YUV_FULL:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16M33Y2R_2020F,   sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16DcInY2R_F,      sizeof(HI_S16) * 3);
            break;
        case HI_DRV_CS_BT709_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16M33Y2R_709L,    sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16DcInY2R_L,      sizeof(HI_S16) * 3);
            break;
        case HI_DRV_CS_BT709_YUV_FULL:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16M33Y2R_709F,    sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16DcInY2R_F,      sizeof(HI_S16) * 3);
            break;
        case HI_DRV_CS_BT601_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16M33Y2R_601L,    sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16DcInY2R_L,      sizeof(HI_S16) * 3);
            break;
        case HI_DRV_CS_BT601_YUV_FULL:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16M33Y2R_601F,    sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16DcInY2R_F,      sizeof(HI_S16) * 3);
            break;
        default:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16M33Y2R_2020L,   sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16DcInY2R_L,      sizeof(HI_S16) * 3);
            break;
    }

    memcpy(pstPqHdrCfg->stY2R.as16DcOutY2R, as16DcOutY2R, sizeof(HI_S16) * 3);
    pstPqHdrCfg->stY2R.u16ClipMinY2R = u16ClipMinY2R;
    pstPqHdrCfg->stY2R.u16ClipMaxY2R = u16ClipMaxY2R;

    return HI_SUCCESS;
}

static HI_S32 pq_hal_SetGamutMappingPara(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* GamutMapping */
    pstPqHdrCfg->stGMAP.u16ScaleGMAP = u16ScaleGMap;

    pstPqHdrCfg->stGMAP.u32ClipMinGMAP = u32ClipMinGMap;
    pstPqHdrCfg->stGMAP.u32ClipMaxGMAP = u32ClipMaxGMap;

    if (((HI_DRV_CS_BT2020_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT2020_YUV_FULL == enInCS))
        && ((HI_DRV_CS_BT709_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT709_YUV_FULL == enOutCS))) /* 2020->709 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMap_2020to709, sizeof(HI_S16) * 9);
    }
    else if (((HI_DRV_CS_BT2020_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT2020_YUV_FULL == enInCS))
             && ((HI_DRV_CS_BT2020_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT2020_YUV_FULL == enOutCS)))/* 2020->2020 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMap_linear, sizeof(HI_S16) * 9);
    }
    else if (((HI_DRV_CS_BT709_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT709_YUV_FULL == enInCS))
             && ((HI_DRV_CS_BT2020_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT2020_YUV_FULL == enOutCS)))/* 709->2020 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMap_709to2020, sizeof(HI_S16) * 9);
    }
    else if (((HI_DRV_CS_BT601_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT601_YUV_FULL == enInCS))
             && ((HI_DRV_CS_BT2020_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT2020_YUV_FULL == enOutCS)))/* 601->2020 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMAP_Pal_601_2020, sizeof(HI_S16) * 9);
    }
    else if (((HI_DRV_CS_BT601_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT601_YUV_FULL == enInCS))
             && ((HI_DRV_CS_BT709_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT709_YUV_FULL == enOutCS)))/* 601->709 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMAP_Pal_601_709, sizeof(HI_S16) * 9);
    }
    else
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMap_linear, sizeof(HI_S16) * 9);
    }

    return HI_SUCCESS;
}

static HI_S32 pq_hal_SetHDRTMap(HI_DRV_COLOR_SPACE_E enInCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->stTMAP.u16ScaleLumaCal = u16ScaleLumaCal;

    if ((HI_DRV_CS_BT709_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT709_YUV_FULL == enInCS))
    {
        memcpy(pstPqHdrCfg->stTMAP.au16M3LumaCal, au16M3LumaCal_709, sizeof(HI_U16) * 3);
    }
    else if ((HI_DRV_CS_BT2020_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT2020_YUV_FULL == enInCS))
    {
        memcpy(pstPqHdrCfg->stTMAP.au16M3LumaCal, au16M3LumaCal_2020, sizeof(HI_U16) * 3);
    }
    else
    {
        memcpy(pstPqHdrCfg->stTMAP.au16M3LumaCal, au16M3LumaCal_601, sizeof(HI_U16) * 3);
    }

    pstPqHdrCfg->stTMAP.u32ClipMinTM = u32ClipMinTM;
    pstPqHdrCfg->stTMAP.u32ClipMaxTM = u32ClipMaxTM;
    memset(pstPqHdrCfg->stTMAP.as32TMOff, 0, sizeof(HI_S32) * 3);

    switch (sg_enHDRMode)
    {
        case HI_PQ_HDR_MODE_HDR10_TO_SDR:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_HDR10toSDR;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, au32TMLut_HDR10toSDR, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_HDR10_TO_HDR10:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_Linear;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, au32TMLut_Linear, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_HLG_TO_SDR:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_HLGtoSDR;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, au32TMLut_HLGtoSDR, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_HLG_TO_HDR10:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_HLGtoHDR10;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, au32TMLut_HLGtoHDR10, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_SLF_TO_SDR:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_SLF2SDR;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, au32TMLut_SLF2SDR, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_SLF_TO_HDR10:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_Linear;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, au32TMLut_Linear, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_SDR_TO_HDR10:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_SDR2HDR;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMLut_x_step_sdr2hdr10, sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMLut_x_pos_sdr2hdr10,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMLut_x_num_sdr2hdr10,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, au32TMLut_SDR2HDR, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
            break;
        default:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_Linear;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, au32TMLut_Linear, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
    }

    if (0 == sg_u32HdrTmMode)
    {
    }
    else if (1 == sg_u32HdrTmMode)
    {
        memcpy(pstPqHdrCfg->stTMAP.au32StepTM, g_u32TMLutXStep, sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
        memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  g_u32TMLutXPos,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
        memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  g_u32TMLutXNum,  sizeof(HI_U32) * PQ_TMAP_SEG_SIZE);
        memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, g_u32TMLut_debug, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
    }
    else if (2 == sg_u32HdrTmMode)
    {
        memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, g_u32TMLut_debug, sizeof(HI_U32) * PQ_TMAP_LUT_SIZE);
        HiPP_HDR_HDR10toSDRTMApi(pstPqHdrCfg, &stDminfo);
    }

    return HI_SUCCESS;
}

static HI_S32 pq_hal_SetHDRSMap(HI_DRV_COLOR_SPACE_E enInCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* ToneMapping Smap */
    pstPqHdrCfg->stCadj.u16Scale2P = u16SmapScaleCoef;

    switch (sg_enHDRMode)
    {
        case HI_PQ_HDR_MODE_HDR10_TO_SDR:
            memcpy(pstPqHdrCfg->stSMAP.au32StepTM, au32SMapStep, sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32PosTM,  au32SMapPos,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32NumTM,  au32SMapNum,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.pu32LUTTM, au32SMLut_HDR10toSDR, sizeof(HI_U32) * PQ_SMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_HDR10_TO_HDR10:
            memcpy(pstPqHdrCfg->stSMAP.au32StepTM, au32SMapStep, sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32PosTM,  au32SMapPos,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32NumTM,  au32SMapNum,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.pu32LUTTM, au32SMLutLinear, sizeof(HI_U32) * PQ_SMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_HLG_TO_SDR:
            memcpy(pstPqHdrCfg->stSMAP.au32StepTM, au32SMapStep, sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32PosTM,  au32SMapPos,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32NumTM,  au32SMapNum,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.pu32LUTTM, au32SMLut_HLGtoSDR, sizeof(HI_U32) * PQ_SMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_HLG_TO_HDR10:
            memcpy(pstPqHdrCfg->stSMAP.au32StepTM, au32SMapStep, sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32PosTM,  au32SMapPos,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32NumTM,  au32SMapNum,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.pu32LUTTM, au32SMLutLinear, sizeof(HI_U32) * PQ_SMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_SLF_TO_SDR:
            memcpy(pstPqHdrCfg->stSMAP.au32StepTM, au32SMapStep, sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32PosTM,  au32SMapPos,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32NumTM,  au32SMapNum,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.pu32LUTTM, au32SMLut_SLF2SDR, sizeof(HI_U32) * PQ_SMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_SLF_TO_HDR10:
            memcpy(pstPqHdrCfg->stSMAP.au32StepTM, au32SMapStep, sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32PosTM,  au32SMapPos,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32NumTM,  au32SMapNum,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.pu32LUTTM, au32SMLutLinear, sizeof(HI_U32) * PQ_SMAP_LUT_SIZE);
            break;
        case HI_PQ_HDR_MODE_SDR_TO_HDR10:
            memcpy(pstPqHdrCfg->stSMAP.au32StepTM, au32SMLut_x_step_sdr2hdr10, sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32PosTM,  au32SMLut_x_pos_sdr2hdr10,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32NumTM,  au32SMLut_x_num_sdr2hdr10,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.pu32LUTTM, au32SMLut_SDR2HDR, sizeof(HI_U32) * PQ_SMAP_LUT_SIZE);
            break;
        default:
            memcpy(pstPqHdrCfg->stSMAP.au32StepTM, au32SMapStep, sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32PosTM,  au32SMapPos,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.au32NumTM,  au32SMapNum,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
            memcpy(pstPqHdrCfg->stSMAP.pu32LUTTM, au32SMLutLinear, sizeof(HI_U32) * PQ_SMAP_LUT_SIZE);
    }

    if (0 == sg_u32HdrSmMode)
    {
    }
    else if (1 == sg_u32HdrSmMode)
    {
        memcpy(pstPqHdrCfg->stSMAP.au32StepTM, g_u32SMLutXStep, sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
        memcpy(pstPqHdrCfg->stSMAP.au32PosTM,  g_u32SMLutXPos,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
        memcpy(pstPqHdrCfg->stSMAP.au32NumTM,  g_u32SMLutXNum,  sizeof(HI_U32) * PQ_SMAP_SEG_SIZE);
        memcpy(pstPqHdrCfg->stSMAP.pu32LUTTM, g_u32SMLut_debug, sizeof(HI_U32) * PQ_SMAP_LUT_SIZE);
    }
    else if (2 == sg_u32HdrSmMode)
    {
    }

    return HI_SUCCESS;
}

static HI_S32 pq_hal_SetR2YMatrix(HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* RGB2YUV */
    pstPqHdrCfg->stR2Y.u16ScaleR2Y = u16ScaleR2Y;

    switch (enOutCS)
    {
        case HI_DRV_CS_BT2020_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YL_2020NCL, sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YL,  sizeof(HI_S16) * 3);
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YL, sizeof(HI_S16) * 3);
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YL_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YL_UV;
            break;
        case HI_DRV_CS_BT2020_YUV_FULL:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YF_2020NCL, sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YF,  sizeof(HI_S16) * 3);
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YF, sizeof(HI_S16) * 3);
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YF_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YF_UV;
            break;
        case HI_DRV_CS_BT709_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YL_709, sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YL,  sizeof(HI_S16) * 3);
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YL, sizeof(HI_S16) * 3);
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YL_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YL_UV;
            break;
        case HI_DRV_CS_BT709_YUV_FULL:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YF_709, sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YF,  sizeof(HI_S16) * 3);
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YF, sizeof(HI_S16) * 3);
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YF_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YF_UV;
            break;
        case HI_DRV_CS_BT601_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YL_601, sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YL,  sizeof(HI_S16) * 3);
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YL, sizeof(HI_S16) * 3);
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YL_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YL_UV;
            break;
        case HI_DRV_CS_BT601_YUV_FULL:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YF_601, sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YF,  sizeof(HI_S16) * 3);
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YF, sizeof(HI_S16) * 3);
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YF_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YF_UV;
            break;
        case HI_DRV_CS_BT2020_RGB_FULL: /*R2R */
        case HI_DRV_CS_BT709_RGB_FULL: /*R2R */
        case HI_DRV_CS_BT601_RGB_FULL: /*R2R */
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2RF,   sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2RF,  sizeof(HI_S16) * 3);
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2RF, sizeof(HI_S16) * 3);
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2RF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2RF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2RF_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2RF_UV;
            break;
        default:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YL_709, sizeof(HI_S16) * 9);
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YL,  sizeof(HI_S16) * 3);
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YL, sizeof(HI_S16) * 3);
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YL_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YL_UV;
            break;
    }

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetHDR10toHDR10Cfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* WCG */
    if (enInCS != enOutCS)
    {
        pstPqHdrCfg->bY2REn         = HI_TRUE;
        pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_TRUE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_TRUE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_TRUE;
        pstPqHdrCfg->bGammaEn       = HI_TRUE;
        pstPqHdrCfg->bDitherEn      = HI_FALSE;
        pstPqHdrCfg->bR2YEn         = HI_TRUE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_TRUE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }
    else
    {
        pstPqHdrCfg->bY2REn         = HI_FALSE;
        pstPqHdrCfg->bV0Y2REn       = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_FALSE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_FALSE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_FALSE;
        pstPqHdrCfg->bGammaEn       = HI_FALSE;
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDitherEn      = HI_FALSE;
        pstPqHdrCfg->bR2YEn         = HI_FALSE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_FALSE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_PQ, sizeof(HI_U32) * PQ_DEGMM_LUT_SIZE);

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmLut_x_step, sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmLut_x_pos,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmLut_x_num,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_PQ10000, sizeof(HI_U32) * PQ_GMM_LUT_SIZE);

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(HI_S16) * 9);

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(HI_S16) * 3);
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(HI_S16) * 3);

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetHDR10toSDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_PQ, sizeof(HI_U32) * PQ_DEGMM_LUT_SIZE);

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmLut_x_step, sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmLut_x_pos,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmLut_x_num,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_22,  sizeof(HI_U32) * PQ_GMM_LUT_SIZE);

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(HI_S16) * 9);

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(HI_S16) * 3);
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(HI_S16) * 3);

    return HI_SUCCESS;
}

HI_S32 pq_hal_GetHLGtoSDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */

    pstPqHdrCfg->bV1Y2REn       = HI_FALSE; /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;  /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_HLG, sizeof(HI_U32) * PQ_DEGMM_LUT_SIZE);

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmLut_x_step, sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmLut_x_pos,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmLut_x_num,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_22,  sizeof(HI_U32) * PQ_GMM_LUT_SIZE);
    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(HI_S16) * 9);

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(HI_S16) * 3);
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(HI_S16) * 3);

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetHLGtoHDR10Cfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_HLG, sizeof(HI_U32) * PQ_DEGMM_LUT_SIZE);

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmLut_x_step, sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmLut_x_pos,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmLut_x_num,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_PQ1250,  sizeof(HI_U32) * PQ_GMM_LUT_SIZE);

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(HI_S16) * 9);

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(HI_S16) * 3);
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(HI_S16) * 3);

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetHLGtoHLGCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* WCG */
    if (enInCS != enOutCS)
    {
        pstPqHdrCfg->bY2REn         = HI_TRUE;
        pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_TRUE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_TRUE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_TRUE;
        pstPqHdrCfg->bGammaEn       = HI_TRUE;
        pstPqHdrCfg->bDitherEn      = HI_TRUE;
        pstPqHdrCfg->bR2YEn         = HI_TRUE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_TRUE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }
    else
    {
        pstPqHdrCfg->bY2REn         = HI_FALSE;
        pstPqHdrCfg->bV0Y2REn       = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_FALSE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_FALSE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_FALSE;
        pstPqHdrCfg->bGammaEn       = HI_FALSE;
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDitherEn      = HI_FALSE;
        pstPqHdrCfg->bR2YEn         = HI_FALSE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_FALSE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_HLG, sizeof(HI_U32) * PQ_DEGMM_LUT_SIZE);

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmLut_x_step, sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmLut_x_pos,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmLut_x_num,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_HLG, sizeof(HI_U32) * PQ_GMM_LUT_SIZE);

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(HI_S16) * 9);

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(HI_S16) * 3);
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(HI_S16) * 3);

    return HI_SUCCESS;
}


static HI_S32 pq_hal_GetSLFtoSDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_22, sizeof(HI_U32) * PQ_DEGMM_LUT_SIZE);
    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmLut_x_step, sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmLut_x_pos,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmLut_x_num,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_22,  sizeof(HI_U32) * PQ_GMM_LUT_SIZE);

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(HI_S16) * 9);

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(HI_S16) * 3);
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(HI_S16) * 3);

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetSLFtoHDR10Cfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_SLF, sizeof(HI_U32) * PQ_DEGMM_LUT_SIZE);

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmLut_x_step, sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmLut_x_pos,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmLut_x_num,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_PQ10000,  sizeof(HI_U32) * PQ_GMM_LUT_SIZE);

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(HI_S16) * 9);

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(HI_S16) * 3);
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(HI_S16) * 3);

    return HI_SUCCESS;
}


static HI_S32 pq_hal_GetSDRtoHDR10Cfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

    pstPqHdrCfg->bGMapPosSel    = HI_FALSE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);

    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_24, sizeof(HI_U32) * PQ_DEGMM_LUT_SIZE);

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmLut_x_step, sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmLut_x_pos,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmLut_x_num,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);

    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_PQ1000, sizeof(HI_U32) * PQ_GMM_LUT_SIZE);

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(HI_S16) * 9);

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(HI_S16) * 3);
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(HI_S16) * 3);

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetSDRtoSDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* WCG */
    if (enInCS != enOutCS)
    {
        pstPqHdrCfg->bY2REn         = HI_TRUE;
        pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_TRUE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_TRUE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_TRUE;
        pstPqHdrCfg->bGammaEn       = HI_TRUE;
        pstPqHdrCfg->bDitherEn      = HI_TRUE;
        pstPqHdrCfg->bR2YEn         = HI_TRUE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_TRUE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_TRUE;
    }
    else
    {
        pstPqHdrCfg->bY2REn         = HI_FALSE;
        pstPqHdrCfg->bV0Y2REn       = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_FALSE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_FALSE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_FALSE;
        pstPqHdrCfg->bGammaEn       = HI_FALSE;
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDitherEn      = HI_FALSE;
        pstPqHdrCfg->bR2YEn         = HI_FALSE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_FALSE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }

    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(HI_U32) * PQ_DEGMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_22, sizeof(HI_U32) * PQ_DEGMM_LUT_SIZE);

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmLut_x_step, sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmLut_x_pos,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmLut_x_num,  sizeof(HI_U32) * PQ_GMM_SEG_SIZE);

    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_22,  sizeof(HI_U32) * PQ_GMM_LUT_SIZE);

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(HI_S16) * 9);

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(HI_S16) * 3);
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(HI_S16) * 3);

    return HI_SUCCESS;
}


HI_S32 PQ_HAL_GetHDRCfg(HI_PQ_WIN_HDR_INFO *pstWinHdrInfo, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    HI_S32 s32Ret = HI_FAILURE;

    PQ_CHECK_NULL_PTR(pstWinHdrInfo);
    PQ_CHECK_NULL_PTR(pstPqHdrCfg);

    pg_stPqHdrCfg = pstPqHdrCfg;

    stDminfo.u32SrcMaxPQ = pstWinHdrInfo->unHDRInfo.stHDR10Info.stMasteringInfo.u32MaxDisplayMasteringLuminance;
    stDminfo.u32SrcMinPQ = pstWinHdrInfo->unHDRInfo.stHDR10Info.stMasteringInfo.u32MinDisplayMasteringLuminance;

    if ((HI_DRV_VIDEO_FRAME_TYPE_HDR10 == pstWinHdrInfo->enSrcFrameType) && (HI_PQ_DISP_TYPE_HDR10 == pstWinHdrInfo->enDispType))
    {
        sg_enHDRMode = HI_PQ_HDR_MODE_HDR10_TO_HDR10;
        s32Ret       = pq_hal_GetHDR10toHDR10Cfg(pstWinHdrInfo->enInCS, pstWinHdrInfo->enOutCS, pstPqHdrCfg);
    }
    else if ((HI_DRV_VIDEO_FRAME_TYPE_HDR10 == pstWinHdrInfo->enSrcFrameType) && (HI_PQ_DISP_TYPE_NORMAL == pstWinHdrInfo->enDispType))
    {
        sg_enHDRMode = HI_PQ_HDR_MODE_HDR10_TO_SDR;
        s32Ret       = pq_hal_GetHDR10toSDRCfg(pstWinHdrInfo->enInCS, pstWinHdrInfo->enOutCS, pstPqHdrCfg);
    }
    else if ((HI_DRV_VIDEO_FRAME_TYPE_HLG == pstWinHdrInfo->enSrcFrameType) && (HI_PQ_DISP_TYPE_NORMAL == pstWinHdrInfo->enDispType))
    {
        sg_enHDRMode = HI_PQ_HDR_MODE_HLG_TO_SDR;
        s32Ret       = pq_hal_GetHLGtoSDRCfg(pstWinHdrInfo->enInCS, pstWinHdrInfo->enOutCS, pstPqHdrCfg);
    }
    else if ((HI_DRV_VIDEO_FRAME_TYPE_HLG == pstWinHdrInfo->enSrcFrameType) && (HI_PQ_DISP_TYPE_HDR10 == pstWinHdrInfo->enDispType))
    {
        sg_enHDRMode = HI_PQ_HDR_MODE_HLG_TO_HDR10;
        s32Ret       = pq_hal_GetHLGtoHDR10Cfg(pstWinHdrInfo->enInCS, pstWinHdrInfo->enOutCS, pstPqHdrCfg);
    }
    else if ((HI_DRV_VIDEO_FRAME_TYPE_HLG == pstWinHdrInfo->enSrcFrameType) && (HI_PQ_DISP_TYPE_HLG == pstWinHdrInfo->enDispType))
    {
        sg_enHDRMode = HI_PQ_HDR_MODE_HLG_TO_HLG;
        s32Ret       = pq_hal_GetHLGtoHLGCfg(pstWinHdrInfo->enInCS, pstWinHdrInfo->enOutCS, pstPqHdrCfg);
    }
    else if ((HI_DRV_VIDEO_FRAME_TYPE_SLF == pstWinHdrInfo->enSrcFrameType) && (HI_PQ_DISP_TYPE_NORMAL == pstWinHdrInfo->enDispType))
    {
        sg_enHDRMode = HI_PQ_HDR_MODE_SLF_TO_SDR;
        s32Ret       = pq_hal_GetSLFtoSDRCfg(pstWinHdrInfo->enInCS, pstWinHdrInfo->enOutCS, pstPqHdrCfg);
    }
    else if ((HI_DRV_VIDEO_FRAME_TYPE_SLF == pstWinHdrInfo->enSrcFrameType) && (HI_PQ_DISP_TYPE_HDR10 == pstWinHdrInfo->enDispType))
    {
        sg_enHDRMode = HI_PQ_HDR_MODE_SLF_TO_HDR10;
        s32Ret       = pq_hal_GetSLFtoHDR10Cfg(pstWinHdrInfo->enInCS, pstWinHdrInfo->enOutCS, pstPqHdrCfg);
    }
    else if ((HI_DRV_VIDEO_FRAME_TYPE_SDR == pstWinHdrInfo->enSrcFrameType) && (HI_PQ_DISP_TYPE_HDR10 == pstWinHdrInfo->enDispType))
    {
        sg_enHDRMode = HI_PQ_HDR_MODE_SDR_TO_HDR10;
        s32Ret       = pq_hal_GetSDRtoHDR10Cfg(pstWinHdrInfo->enInCS, pstWinHdrInfo->enOutCS, pstPqHdrCfg);
    }
    else if ((HI_DRV_VIDEO_FRAME_TYPE_SDR == pstWinHdrInfo->enSrcFrameType) && (HI_PQ_DISP_TYPE_NORMAL == pstWinHdrInfo->enDispType))
    {
        sg_enHDRMode = HI_PQ_HDR_MODE_SDR_TO_SDR;
        s32Ret       = pq_hal_GetSDRtoSDRCfg(pstWinHdrInfo->enInCS, pstWinHdrInfo->enOutCS, pstPqHdrCfg);
    }

    sg_u32TMScaleCoef = pstPqHdrCfg->stTMAP.u16ScaleCoefTM;
    sg_u32SMScaleCoef = pstPqHdrCfg->stCadj.u16Scale2P;

    return s32Ret;
}

static HI_VOID pq_hal_SetHDRPqParamDefault(HI_VOID)
{
    if (HI_NULL == sg_pstHalHdrPqParam)
    {
        return;
    }

    return ;
}

HI_S32 PQ_HAL_SetHDRSaturation(HI_U32 u32Saturation)
{

    /* 98mv200 HDR saturation adjust : only 10 11 12 20 21 22 , 00 01 02 do not change
       0->0.5; 50->1; 100->1.5 */

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_InitHDR(PQ_PARAM_S *pstPqParam, HI_BOOL bDefault)
{
    HI_U32 u32HdrSaturation   = 50;

    sg_pstHalHdrPqParam = pstPqParam;

    PQ_CHECK_NULL_PTR(sg_pstHalHdrPqParam);

    if (HI_TRUE == bDefault)
    {
        pq_hal_SetHDRPqParamDefault();
    }

    PQ_HAL_SetHDRSaturation(u32HdrSaturation);

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHDRTmLut(HI_PQ_HDR_TM_LUT_S *pstTMSetLut)
{
    return HI_SUCCESS;
}

HI_S32 PQ_HAL_GetHDRTmLut(HI_PQ_HDR_TM_LUT_S *pstTMSetLut)
{
    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHDRDefaultCfg(HI_BOOL bDefault)
{
    pq_hal_SetHDRPqParamDefault();

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHDRTmXpos(HI_U8 *pstTMSetXpos)
{
    PQ_CHECK_NULL_PTR(pstTMSetXpos);

    memcpy(g_u32TMLutXStep, pstTMSetXpos, sizeof(g_u32TMLutXStep));
    memcpy(g_u32TMLutXPos, pstTMSetXpos + 8 * sizeof(HI_U32),  sizeof(g_u32TMLutXPos));
    memcpy(g_u32TMLutXNum, pstTMSetXpos + 16 * sizeof(HI_U32), sizeof(g_u32TMLutXNum));

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_GetHDRTmXpos(HI_U8 *pstTMSetXpos)
{
    PQ_CHECK_NULL_PTR(pstTMSetXpos);
    PQ_CHECK_NULL_PTR(g_u32TMLutXStep);
    PQ_CHECK_NULL_PTR(g_u32TMLutXPos);
    PQ_CHECK_NULL_PTR(g_u32TMLutXNum);

    memcpy((HI_U32 *)pstTMSetXpos, g_u32TMLutXStep, sizeof(g_u32TMLutXStep));
    memcpy((HI_U32 *)(pstTMSetXpos + 8 * sizeof(HI_U32)),  g_u32TMLutXPos, sizeof(g_u32TMLutXPos));
    memcpy((HI_U32 *)(pstTMSetXpos + 16 * sizeof(HI_U32)), g_u32TMLutXNum, sizeof(g_u32TMLutXNum));

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_GetHDRSrcLum(HI_PQ_HDR_SRC_LUM_S *pstGetSrclum)
{
    PQ_CHECK_NULL_PTR(pstGetSrclum);

    pstGetSrclum->u32MinLum = sg_u32SrcMinPQ;
    pstGetSrclum->u32MaxLum = sg_u32SrcMaxPQ;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHDRParaMode(HI_PQ_HDR_PARA_MODE_S *pstSetParaMode)
{
    PQ_CHECK_NULL_PTR(pstSetParaMode);

    sg_u32HdrTmMode = pstSetParaMode->u32HdrTmMode;
    sg_u32HdrSmMode = pstSetParaMode->u32HdrSmMode;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_GetHDRParaMode(HI_PQ_HDR_PARA_MODE_S *pstGetParaMode)
{
    PQ_CHECK_NULL_PTR(pstGetParaMode);

    pstGetParaMode->u32HdrTmMode = sg_u32HdrTmMode;
    pstGetParaMode->u32HdrSmMode = sg_u32HdrSmMode;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHDRSoftPara(HI_PQ_HDR_SOFT_PARA_S *pstSetSoftPara)
{
    PQ_CHECK_NULL_PTR(pstSetSoftPara);

    sg_u32TMScaleCoef   = pstSetSoftPara->u32TMScaleCoef;
    sg_u32SrcAvgLum     = pstSetSoftPara->u32SrcAvgLum;
    sg_u32TargMinLum    = pstSetSoftPara->u32TargMinLum;
    sg_u32TargAvgLum    = pstSetSoftPara->u32TargAvgLum;
    sg_u32TargMaxLum    = pstSetSoftPara->u32TargMaxLum;
    sg_u32UhdMaxLumDefault = pstSetSoftPara->u32UhdMaxLumDefault;
    sg_u32FhdMaxLumDefault = pstSetSoftPara->u32FhdMaxLumDefault;
    sg_u32Contrast = pstSetSoftPara->u32Contrast;
    sg_u32HdrLwAvg = pstSetSoftPara->u32HdrLwAvg;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_GetHDRSoftPara(HI_PQ_HDR_SOFT_PARA_S *pstGetSoftPara)
{
    PQ_CHECK_NULL_PTR(pstGetSoftPara);

    pstGetSoftPara->u32TMScaleCoef = sg_u32TMScaleCoef;
    pstGetSoftPara->u32SrcAvgLum   = sg_u32SrcAvgLum;
    pstGetSoftPara->u32TargMinLum  = sg_u32TargMinLum;
    pstGetSoftPara->u32TargAvgLum  = sg_u32TargAvgLum;
    pstGetSoftPara->u32TargMaxLum  = sg_u32TargMaxLum;
    pstGetSoftPara->u32Contrast    = sg_u32Contrast;
    pstGetSoftPara->u32HdrLwAvg    = sg_u32HdrLwAvg;
    pstGetSoftPara->u32UhdMaxLumDefault = sg_u32UhdMaxLumDefault;
    pstGetSoftPara->u32FhdMaxLumDefault = sg_u32FhdMaxLumDefault;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHDRToneMap(HI_U8 *pstHDRToneMap)
{
    HI_U32 pTM_ylut[64] = {0};
    // HI_U32 pTM_xlut[64]={0};
    HI_U32 pTM_Map[64] = {0};
    HI_U32 u32TmpNum = 0;
    HI_U32 u32TmpPos = 0;
    HI_U32 u32NumCur = 0 ;
    HI_U32 u32PanelMaxLum = 0;
    HI_U32 i = 0, k = 0;
    HI_U32 u32TMbitOut = 0;
    HI_U64 u64Data = 0;

    PQ_CHECK_NULL_PTR(pstHDRToneMap);

    memcpy(pTM_ylut,  pstHDRToneMap + 32 * sizeof(HI_U32), sizeof(g_u32TMLut_debug));
    u32PanelMaxLum = pTM_ylut[63];

    memcpy(g_u32TMLutXStep, pstHDRToneMap, sizeof(g_u32TMLutXStep));
    memcpy(g_u32TMLutXNumP, pstHDRToneMap + 8 * sizeof(HI_U32),  sizeof(g_u32TMLutXNumP));
    memcpy(g_u32TMLutXNum,  pstHDRToneMap + 16 * sizeof(HI_U32), sizeof(g_u32TMLutXNum));
    memcpy(g_u32TMLutXPos,  pstHDRToneMap + 24 * sizeof(HI_U32), sizeof(g_u32TMLutXPos));
    memcpy(pTM_ylut,  pstHDRToneMap + 32 * sizeof(HI_U32), sizeof(g_u32TMLut_debug));

    u32TMbitOut = sg_u32TMScaleCoef;
    HI_INFO_PQ("Bit:%d\n", u32TMbitOut);

    if ((HI_U64)u32PanelMaxLum == 0)
    {
        HI_ERR_PQ("Valid Parameter u32PanelMaxLum! Please adjust the curve!");
        return HI_FAILURE;
    }

    u64Data = div64_s64((HI_U64)pTM_ylut[0] << 31, (HI_U64)u32PanelMaxLum);

    if ( u32TMbitOut >= 10 )
    {
        pTM_Map[i] = (HI_U32) div64_s64((u64Data << (u32TMbitOut - 10)), 1) ;
    }
    else
    {
        pTM_Map[i] =  (HI_U32) div64_s64((u64Data >> ( 10 - u32TMbitOut)), 1) ;
    }

    for ( i = 1 ; i < 64 ; i++)
    {
        u32TmpNum = i ;

        if ( u32TmpNum <= g_u32TMLutXNum[0] )
        {
            u32TmpPos = (1 << g_u32TMLutXStep[0]) * u32TmpNum + 1 ;
        }
        else
        {
            for (k = 1; k < 8 ; k++)
            {
                if ( u32TmpNum <= g_u32TMLutXNum[k] )
                {
                    u32NumCur = u32TmpNum - g_u32TMLutXNum[k - 1] ;
                    u32TmpPos = g_u32TMLutXPos[k - 1]  + (1 << g_u32TMLutXStep[k]) * u32NumCur  + 1;
                    break;
                }
            }
        }

        u32TmpPos = HDR_MIN(u32TmpPos, 2097151) ;

        if ((HI_U64)u32PanelMaxLum == 0)
        {
            HI_ERR_PQ("Valid Parameter u32TmpPos! Please adjust the curve!");
            return HI_FAILURE;
        }

        u64Data   = div64_s64((HI_U64)pTM_ylut[i] << 31, (HI_U64)u32PanelMaxLum) ;

        if ((HI_U64)u32TmpPos == 0)
        {
            HI_ERR_PQ("Valid Parameter u32TmpPos! Please adjust the curve!");
            return HI_FAILURE;
        }

        if ( u32TMbitOut >= 10 )
        {
            pTM_Map[i] = (HI_U32) div64_s64((u64Data << (u32TMbitOut - 10)), (HI_U64)u32TmpPos) ;
        }
        else
        {
            pTM_Map[i] =  (HI_U32) div64_s64((u64Data >> ( 10 - u32TMbitOut)), (HI_U64)u32TmpPos) ;
        }

    }

    memcpy(g_u32TMLut_debug,  pTM_Map, sizeof(g_u32TMLut_debug));

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_GetHDRTYMap(HI_U8 *pstHDRTYMap)
{
    PQ_CHECK_NULL_PTR(pstHDRTYMap);
    PQ_CHECK_NULL_PTR(g_u32TMLut_debug);

    memcpy((HI_U32 *)pstHDRTYMap, g_u32TMLut_debug, sizeof(g_u32TMLut_debug));

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHDRTYMap(HI_U8 *pstHDRTYMap)
{
    PQ_CHECK_NULL_PTR(pstHDRTYMap);

    memcpy(g_u32TMLut_debug, (HI_U32 *)pstHDRTYMap, sizeof(g_u32TMLut_debug));

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_GetHDRToneMap(HI_U8 *pstHDRToneMap)
{
    HI_U32 pTM_ylut[64] = {0};
    HI_U32 pTM_Map[64] = {0};
    HI_U32 u32TmpNum = 0;
    HI_U32 u32TmpPos = 0;
    HI_U32 u32NumCur = 0 ;
    HI_U32 u32PanelMaxLum = 0;
    HI_U32 i = 0, k = 0;
    HI_U32 u32TMbitOut = 0;
    HI_U64 u64ytmp = 0;

    PQ_CHECK_NULL_PTR(pstHDRToneMap);

    g_u32TMLutXNumP[0] = g_u32TMLutXNum[0];

    for (i = 1; i < 8; i++)
    {
        g_u32TMLutXNumP[i] = g_u32TMLutXNum[i] - g_u32TMLutXNum[i - 1];
    }

    memcpy((HI_U32 *)pstHDRToneMap, g_u32TMLutXStep, sizeof(g_u32TMLutXStep));
    memcpy((HI_U32 *)(pstHDRToneMap + 8 * sizeof(HI_U32)),  g_u32TMLutXNumP, sizeof(g_u32TMLutXNumP));
    memcpy((HI_U32 *)(pstHDRToneMap + 16 * sizeof(HI_U32)), g_u32TMLutXNum , sizeof(g_u32TMLutXNum));
    memcpy((HI_U32 *)(pstHDRToneMap + 24 * sizeof(HI_U32)), g_u32TMLutXPos , sizeof(g_u32TMLutXPos));
    memcpy(pTM_Map, g_u32TMLut_debug, sizeof(g_u32TMLut_debug));
    u32TMbitOut = sg_u32TMScaleCoef;

    u32PanelMaxLum = sg_u32TargMaxLum;
    u32PanelMaxLum = div64_s64(u32PanelMaxLum, 10000) ;

    if ( u32TMbitOut >= 10 )
    {
        u64ytmp = ((HI_U64)pTM_Map[0]) >> (u32TMbitOut - 10);
    }
    else
    {
        u64ytmp = ((HI_U64)pTM_Map[0]) << (u32TMbitOut - 10);
    }

    pTM_ylut[0] = (HI_U32)((u64ytmp * u32PanelMaxLum) >> 31);

    for ( i = 1 ; i < 64 ; i++)
    {
        u32TmpNum = i ;

        if ( u32TmpNum <= g_u32TMLutXNum[0] )
        {
            u32TmpPos = (1 << g_u32TMLutXStep[0]) * u32TmpNum + 1 ;
        }
        else
        {
            for (k = 1; k < 8 ; k++)
            {
                if ( u32TmpNum <= g_u32TMLutXNum[k] )
                {
                    u32NumCur = u32TmpNum - g_u32TMLutXNum[k - 1] ;
                    u32TmpPos = g_u32TMLutXPos[k - 1]  + (1 << g_u32TMLutXStep[k]) * u32NumCur  + 1;
                    break;
                }
            }
        }

        u32TmpPos = HDR_MIN(u32TmpPos, 2097151) ;

        if ( u32TMbitOut >= 10 )
        {
            u64ytmp = ((HI_U64)pTM_Map[i] * u32TmpPos) >> (u32TMbitOut - 10);
        }
        else
        {
            u64ytmp = ((HI_U64)pTM_Map[i] * u32TmpPos) << (u32TMbitOut - 10);
        }

        pTM_ylut[i] = (HI_U32)((u64ytmp * u32PanelMaxLum) >> 31);
    }

    memcpy((HI_U32 *)(pstHDRToneMap + 32 * sizeof(HI_U32)), pTM_ylut, sizeof(pTM_ylut));

    return HI_SUCCESS;
}


HI_S32 PQ_HAL_SetHDRSatMap(HI_U8 *pstHDRSatMap)
{
    HI_U32 pSM_ylut[64] = {0};
    HI_U32 i = 0;
    HI_U32 u32SMbitOut = 0;

    PQ_CHECK_NULL_PTR(pstHDRSatMap);

    memcpy(g_u32SMLutXStep, pstHDRSatMap, sizeof(g_u32SMLutXStep));
    memcpy(g_u32SMLutXNumP, pstHDRSatMap + 8 * sizeof(HI_U32),  sizeof(g_u32SMLutXNumP));
    memcpy(g_u32SMLutXNum,  pstHDRSatMap + 16 * sizeof(HI_U32), sizeof(g_u32SMLutXNum));
    memcpy(g_u32SMLutXPos,  pstHDRSatMap + 24 * sizeof(HI_U32), sizeof(g_u32SMLutXNum));
    u32SMbitOut = sg_u32SMScaleCoef;

    memcpy(pSM_ylut, pstHDRSatMap + 32 * sizeof(HI_U32), sizeof(g_u32SMLut_debug));

    for (i = 0; i < 64; i++)
    {
        g_u32SMLut_debug[i] = pSM_ylut[i] >> (16 - u32SMbitOut) ;

        if (i % 8 == 0)
        {
            HI_INFO_PQ("SetSMap:%d\n", g_u32SMLut_debug[i]);
        }
    }

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_GetHDRSatMap(HI_U8 *pstHDRSatMap)
{
    HI_U32 pSM_ylut[64] = {0};
    HI_U32 i = 0;
    HI_U32 u32SMbitOut = 0;

    PQ_CHECK_NULL_PTR(pstHDRSatMap);
    PQ_CHECK_NULL_PTR(g_u32SMLutXStep);
    PQ_CHECK_NULL_PTR(g_u32SMLutXNumP);
    PQ_CHECK_NULL_PTR(g_u32SMLutXNum);
    PQ_CHECK_NULL_PTR(g_u32SMLutXPos);

    memcpy((HI_U32 *)pstHDRSatMap, g_u32SMLutXStep, sizeof(g_u32SMLutXStep));
    memcpy((HI_U32 *)(pstHDRSatMap + 8 * sizeof(HI_U32)),  g_u32SMLutXNumP, sizeof(g_u32SMLutXNumP));
    memcpy((HI_U32 *)(pstHDRSatMap + 16 * sizeof(HI_U32)), g_u32SMLutXNum , sizeof(g_u32SMLutXNum));
    memcpy((HI_U32 *)(pstHDRSatMap + 24 * sizeof(HI_U32)), g_u32SMLutXPos , sizeof(g_u32SMLutXPos));
    u32SMbitOut = sg_u32SMScaleCoef;

    if (u32SMbitOut > 16)
    {
        HI_ERR_PQ("u32SMbitOut > 16!");
        return HI_FAILURE;
    }

    for (i = 0; i < 64; i++)
    {
        pSM_ylut[i] = g_u32SMLut_debug[i] << (16 - u32SMbitOut) ;

        if (i % 8 == 0)
        {
            HI_INFO_PQ("GetSMap:%d\n", g_u32SMLut_debug[i]);
        }
    }

    memcpy((HI_U32 *)(pstHDRSatMap + 32 * sizeof(HI_U32)), pSM_ylut, sizeof(pSM_ylut));

    return HI_SUCCESS;
}

HI_S32  HiPP_HDR_CalcXPos(HI_U32 *pTM_xlut , HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    HI_U32 u32TmpNum = 0;
    HI_U32 u32TmpPos = 0;
    HI_U32 u32NumCur = 0 ;
    HI_U32 i = 0, k = 0;

    PQ_CHECK_NULL_PTR(g_u32TMLutXStep);
    PQ_CHECK_NULL_PTR(g_u32TMLutXPos);
    PQ_CHECK_NULL_PTR(g_u32TMLutXNum);

    memcpy(pstPqHdrCfg->stTMAP.au32StepTM, g_u32TMLutXStep, sizeof(g_u32TMLutXStep));
    memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  g_u32TMLutXPos,  sizeof(g_u32TMLutXStep));
    memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  g_u32TMLutXNum,  sizeof(g_u32TMLutXStep));
    pTM_xlut[0] = 1 ;

    for ( i = 1 ; i < 64 ; i++)
    {
        u32TmpNum = i ;

        if ( u32TmpNum <= g_u32TMLutXStep[0] )
        {
            u32TmpPos = (1 << g_u32TMLutXStep[0]) * u32TmpNum + 1 ;
        }
        else
        {
            for (k = 1; k < 8 ; k++)
            {
                if ( u32TmpNum <= g_u32TMLutXNum[k] )
                {
                    u32NumCur = u32TmpNum - g_u32TMLutXNum[k - 1] ;
                    u32TmpPos = g_u32TMLutXPos[k - 1]  + (1 << g_u32TMLutXStep[k]) * u32NumCur  + 1;
                    break;
                }
            }
        }

        u32TmpPos = HDR_MIN(u32TmpPos, 2097151) ;
        pTM_xlut[i] = u32TmpPos ;
    }

    return HI_SUCCESS;
}

HI_S32 HiPP_HDR_InitToneMappingParam(HDR_TM_PARAM_S *pstHDRParam , DM_INFO_S *pstDminfo)
{
    PQ_CHECK_NULL_PTR(pstHDRParam);
    PQ_CHECK_NULL_PTR(pstDminfo);

    //Metadata vdec传过来,u32SrcMinPQ,u32SrcMaxPQ
    pstHDRParam->u32SrcMinLum = pstDminfo->u32SrcMinPQ;    // Src Min Luminance Value : nits        x1 = 0.005*10000;     //metadate
    pstHDRParam->u32SrcMaxLum = pstDminfo->u32SrcMaxPQ;;   // Src Max Luminance Value : nits    x3 = 1200*10000;           //metadate
    sg_u32SrcMinPQ = pstDminfo->u32SrcMinPQ;
    sg_u32SrcMaxPQ = pstDminfo->u32SrcMaxPQ;

    //下面6个参数需要xml输入
    pstHDRParam->u32SrcAvgLum   = sg_u32SrcAvgLum; //150000;          // Src Avg Luminance Value : nits     x2 = 15*10000;
    pstHDRParam->u32TargMinLum  = sg_u32TargMinLum;       //1000;          // Target min Luminance Value : nits  y1 = 0.1*10000;
    pstHDRParam->u32TargAvgLum  = sg_u32TargAvgLum;      //2000000 ;       // Target Avg Luminance Value : nits   y2 = 200*10000;
    pstHDRParam->u32TargMaxLum  = sg_u32TargMaxLum;      //3000000;      // Target Max Luminance Value : nits     y3 = 300*10000;
    pstHDRParam->u32Contrast    = sg_u32Contrast;        //320;           //调节对比度                               n = 1.25*256;
    pstHDRParam->u32LwAvg       = sg_u32HdrLwAvg;        //300  最主要的调节参数 ;  //TM_EXP  源均值亮度

    return HI_SUCCESS;
}

HI_S32 HiPP_HDR_CalcTMExpParaInte(HI_U32 u32LwAvg , HDR_TMExpPARAM_S *pstTMExpPara )
{
    HI_U32 u32QBbitX        = 24 ;
    HI_U32 u32QBbitY        = 30 ;
    HI_U32 u32QBbitSclCoef  = 20 ;
    HI_U32 u32Acoef         = 10000;
    HI_U32 u32Log2exp       = 1512775  ;  //log2(e)*2^20

    pstTMExpPara->u32QBbitX = u32QBbitX ;
    pstTMExpPara->u32QBbitY = u32QBbitY ;
    pstTMExpPara->u32LwAvg  = u32LwAvg ;

    pstTMExpPara->u32Acoef          = u32Acoef ;
    pstTMExpPara->u32Log2exp        = u32Log2exp ;
    pstTMExpPara->u32QBbitSclCoef   = u32QBbitSclCoef ;

    return HI_SUCCESS;
}

HI_U64 HiPP_HDR_FixIntegPower2( HI_U64 u64Data , HI_U32 u32QBbitSclCoef ,  HI_U32  u32QBbitX )
{
    HI_U32  u32C1Power2Frac  = 1482910 ;   //2^(1/2)*2^20
    HI_U32  u32C2Power2Frac  = 1246974 ;
    HI_U32  u32C3Power2Frac  = 1143480 ;
    HI_U32  u32C4Power2Frac  = 1095000 ;
    HI_U32  u32C5Power2Frac  = 1071537 ;
    HI_U32  u32C6Power2Frac  = 1059994 ;
    HI_U32  u32C7Power2Frac  = 1054270 ;
    HI_U32  u32C8Power2Frac  = 1051419 ;
    HI_U32  u32C9Power2Frac  = 1049997 ;
    HI_U32  u32C10Power2Frac = 1049286  ;
    HI_U32  u32C11Power2Frac = 1048931  ;
    HI_U32  u32C12Power2Frac = 1048753  ;
    HI_U32  u32C13Power2Frac = 1048665  ;
    HI_U32  u32C14Power2Frac = 1048620  ;
    HI_U32  u32C15Power2Frac = 1048598  ;

    HI_U32 Coeaf2poly[15]           = {0} ;
    HI_U32 au32CoefPower2Frac[15]   = {0};
    HI_U64 u64MaxVal                =  0x7FFFFFFFFFFFFFFF  ;

    HI_U32 i = 0;
    HI_U32 u32TempData , u32Data ;
    HI_U64 u64Coeaf2polyInteg ;
    HI_U32 icount = 0 ;
    HI_U64 u64Val = 0 ;

    au32CoefPower2Frac[0]  = u32C1Power2Frac;
    au32CoefPower2Frac[1]  = u32C2Power2Frac ;
    au32CoefPower2Frac[2]  = u32C3Power2Frac ;
    au32CoefPower2Frac[3]  = u32C4Power2Frac ;
    au32CoefPower2Frac[4]  = u32C5Power2Frac ;
    au32CoefPower2Frac[5]  = u32C6Power2Frac ;
    au32CoefPower2Frac[6]  = u32C7Power2Frac ;
    au32CoefPower2Frac[7]  = u32C8Power2Frac ;
    au32CoefPower2Frac[8]  = u32C9Power2Frac ;
    au32CoefPower2Frac[9]  = u32C10Power2Frac;

    au32CoefPower2Frac[10] = u32C11Power2Frac;
    au32CoefPower2Frac[11] = u32C12Power2Frac;
    au32CoefPower2Frac[12] = u32C13Power2Frac;
    au32CoefPower2Frac[13] = u32C14Power2Frac;
    au32CoefPower2Frac[14] = u32C15Power2Frac;

    u32Data             =  (u64Data >> (u32QBbitSclCoef + u32QBbitX )) ;
    u64Coeaf2polyInteg  = u32Data & 0xFFFFFFFF ;
    u32Data             = (HI_U32)((u64Data >> 13) & 0x7FFFFFFF) ; // 1 = 2^31

    for (i = 0; i < 15; i++)
    {
        u32TempData     = u32Data & (1 << (30 - i)) ;
        Coeaf2poly[i]   = u32TempData >> (30 - i) ;
    }

    u64Data = 1 ;
    icount  = 0 ;

    for (i = 0; i < 15; i++)
    {
        if ( Coeaf2poly[i] == 1  )
        {
            if ( icount == 0 )
            {
                u64Data = u64Data * au32CoefPower2Frac[i] ;
            }
            else
            {
                u64Data = u64Data * au32CoefPower2Frac[i] ;
                u64Data = u64Data >> 20 ;
            }

            icount = icount + 1 ;
        }
    }

    if ( u64Coeaf2polyInteg <= 42 )
    {
        u64Coeaf2polyInteg = ((HI_U64)1) << (u64Coeaf2polyInteg ) ;
        u64Data =  u64Data * u64Coeaf2polyInteg ;
        u64Val = u64Data ;
    }
    else
    {
        u64Val = u64MaxVal ;
    }

    return u64Val ;

}

HI_U32 HiPP_HDR_CalcTMExpInte(HDR_TMExpPARAM_S *pstTMExpPara , HI_U32 u32XPos)
{
    HI_U64 u64Data ;
    HI_U32 u32QBbitX  ;
    HI_U32 u32QBbitY  ;
    HI_U32 u32Log2exp  ;
    HI_U32 u32LwAvg ;
    HI_U32 u32QBbitSclCoef  ;
    HI_U64 u64Power2x = 0 ;
    HI_U64 u64ValT ;
    HI_U32 u32ExpVal = 0 ;

    u32QBbitX       = pstTMExpPara->u32QBbitX ;
    u32QBbitY       = pstTMExpPara->u32QBbitY ;
    u32QBbitSclCoef = pstTMExpPara->u32QBbitSclCoef ;
    u32Log2exp      = pstTMExpPara->u32Log2exp ;
    u32LwAvg        = pstTMExpPara->u32LwAvg ;

    u64Data = (HI_U64)u32XPos ;

    if ((HI_U64)u32LwAvg == 0)
    {
        HI_ERR_PQ("Valid Parameter u32LwAvg! Please adjust the curve!");
        return HI_FAILURE;
    }

    u64Data = div64_s64((HI_U64)((u64Data << (u32QBbitX - 20)) * 10000 * u32Log2exp), (HI_U64)u32LwAvg) ;
    u64Power2x = HiPP_HDR_FixIntegPower2( u64Data , u32QBbitSclCoef , u32QBbitX )  ;

    if (u64Power2x == 0)
    {
        HI_ERR_PQ("Valid Parameter u64Power2x! Please adjust the curve!");
        return HI_FAILURE;
    }

    u64ValT = div64_s64((((HI_U64)1) << (u32QBbitSclCoef + u32QBbitY)), u64Power2x);

    if (  u64ValT < ((HI_U64)1 << u32QBbitY) )
    {
        u32ExpVal = (HI_U32)u64ValT ;
    }
    else
    {
        u32ExpVal = (1 << u32QBbitY) ;
    }

    u32ExpVal =  (1 << u32QBbitY) - u32ExpVal ;

    return u32ExpVal ;
}

/*--------------------------------------------------------------------------------*
Function                :  HI_U32 HiPP_HDR_CreateToneMappingApi(HI_U32 *paTMYLut , HI_U32 *paSMYLut ,DM_INFO_S *pstDminfo)
Description             :    软算法获取HDR LUT 曲线
Calls                   :
Data Accessed       :
Data Updated        :
Input                   :   pstHdrInfo.CNcomment: HDR10信息CNend;
Output              :   NA
Return                  :   HI_SUCCESS     success.  CNcomment:成功 CNend
Others                  :   NA
*--------------------------------------------------------------------------------*/
HI_S32 HiPP_HDR_HDR10toSDRTMApi(HI_PQ_HDR_CFG *pstPqHdrCfg, DM_INFO_S *pstDminfo)
{
    HI_U32 au32TMXLut[64] = {0} ;
    HI_U32 au32TMpLut[64] = {0} ;
    HDR_TM_PARAM_S stHDRParam ;
    HDR_TMExpPARAM_S stTMExpPara ;
    HI_U32 u32XPos ;
    HI_U32 u32SrcMaxLum = 0 ;
    HI_U32 u32PanelMaxLum = 0 ;
    HI_U32 u32MaxLumXPos , u32MaxExpLum;
    HI_U32 u32ValTemp ;
    HI_U64 u64Data ;
    HI_S32 s32ShiftBit = 0 ;
    HI_S32 i = 0;
    HI_VDP_PQ_INFO_S  stVdpInfo = {0};

    HiPP_HDR_CalcXPos(au32TMXLut, pstPqHdrCfg ) ;

    HiPP_HDR_InitToneMappingParam(&stHDRParam , pstDminfo);

    HiPP_HDR_CalcTMExpParaInte (stHDRParam.u32LwAvg , &stTMExpPara ) ;

    u32PanelMaxLum  = stHDRParam.u32TargMaxLum ;
    u32SrcMaxLum    = stHDRParam.u32SrcMaxLum ;

    if ( u32SrcMaxLum > 5000000 )
    {
        u64Data = (HI_U64)u32SrcMaxLum ;
        u64Data =  div64_s64((u64Data << 21), 10000 * 10000);
    }
    else
    {
        //根据宽高
        if ((stVdpInfo.u32Width >= 3840) && (stVdpInfo.u32Height >= 2160))
        {
            u64Data = sg_u32UhdMaxLumDefault ;
        }
        else
        {
            u64Data = sg_u32FhdMaxLumDefault ;
        }

        u64Data = div64_s64((u64Data << 21), 10000 * 10000) ;
    }

    u32MaxLumXPos = (HI_U32)u64Data ;
    u32MaxExpLum  =  HiPP_HDR_CalcTMExpInte( &stTMExpPara ,  u32MaxLumXPos) ;

    if (u32MaxExpLum == 0)
    {
        u32MaxExpLum = 1;
        HI_INFO_PQ("u32MaxExpLum:%d\n", u32MaxExpLum);
    }

    for (i = 0; i < 64 ; i++)
    {

        u32XPos         = au32TMXLut[i] ;
        u32ValTemp      = HiPP_HDR_CalcTMExpInte( &stTMExpPara ,  u32XPos) ;
        au32TMpLut[i]   = div64_s64(((HI_U64)u32ValTemp << stTMExpPara.u32QBbitY) , (HI_U64)u32MaxExpLum);
    }

    /*读取寄存器的值 OutBit */
    s32ShiftBit = sg_u32TMScaleCoef - (stTMExpPara.u32QBbitY - 21) ;

    for (i = 0; i < 64 ; i++)
    {
        if (au32TMXLut[i] == 0)
        {
            HI_ERR_PQ("Valid Parameter au32TMXLut[i], i = %d\n", i);
            return HI_FAILURE;
        }
    }

    if ( s32ShiftBit >= 0 )
    {
        for (i = 0; i < 64 ; i++)
        {
            pstPqHdrCfg->stTMAP.pu32LUTTM[i] =  div64_u64(((HI_U64)au32TMpLut[i] << ABS(s32ShiftBit)), au32TMXLut[i]) ;
        }
    }
    else
    {
        s32ShiftBit = s32ShiftBit * (-1) ;

        for (i = 0; i < 64 ; i++)
        {
            pstPqHdrCfg->stTMAP.pu32LUTTM[i] = div64_u64(((HI_U64)au32TMpLut[i] >> ABS(s32ShiftBit)), au32TMXLut[i]) ;
        }
    }

    pstPqHdrCfg->stTMAP.pu32LUTTM[0]    = pstPqHdrCfg->stTMAP.pu32LUTTM[1]  ;
    pstPqHdrCfg->stTMAP.u16ScaleCoefTM  = sg_u32TMScaleCoef;

    return HI_SUCCESS;
}

